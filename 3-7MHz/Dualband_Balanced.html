<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dual-Band Balanced Magnetic Loop Antenna — 80 m &amp; 40 m</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --orange-600: #E65100;
  --orange-700: #BF360C;
  --orange-800: #8B1A00;
  --brown-900: #3E2723;
  --brown-800: #4E342E;
  --brown-700: #5D4037;
  --brown-600: #6D4C41;
  --gold: #FFB300;
  --card-bg: rgba(255,255,255,0.82);
  --card-border: rgba(232,200,160,0.5);
  --text-primary: #3E2723;
  --text-secondary: #5D4037;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(160deg, #FFF8F0 0%, #FFECD2 20%, #FFE0B2 40%, #FFE8CC 60%, #FFF0DB 80%, #FFF5E8 100%);
  color: var(--text-primary);
  padding: 20px;
  min-height: 100vh;
  position: relative;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background:
    radial-gradient(1.5px 1.5px at 15% 25%, rgba(230,81,0,0.12) 50%, transparent 50%),
    radial-gradient(1px 1px at 45% 15%, rgba(191,54,12,0.08) 50%, transparent 50%),
    radial-gradient(2px 2px at 75% 35%, rgba(230,81,0,0.1) 50%, transparent 50%),
    radial-gradient(1px 1px at 25% 65%, rgba(191,54,12,0.06) 50%, transparent 50%),
    radial-gradient(1.5px 1.5px at 85% 75%, rgba(230,81,0,0.09) 50%, transparent 50%),
    radial-gradient(1px 1px at 55% 85%, rgba(191,54,12,0.07) 50%, transparent 50%);
  pointer-events: none;
  z-index: 0;
  animation: particleDrift 25s ease-in-out infinite alternate;
}

@keyframes particleDrift {
  0% { transform: translate(0, 0); }
  25% { transform: translate(-8px, 5px); }
  50% { transform: translate(5px, -8px); }
  75% { transform: translate(-3px, -5px); }
  100% { transform: translate(8px, 3px); }
}

.container {
  max-width: 1100px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

/* ── Header ── */
.header {
  background: linear-gradient(135deg, #3E2723 0%, #4E342E 30%, #5D4037 60%, #6D4C41 100%);
  border-radius: 20px;
  padding: 28px 36px 24px;
  margin-bottom: 16px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(62,39,35,0.3);
}

.header::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background:
    radial-gradient(ellipse 600px 200px at 20% 50%, rgba(255,179,0,0.08), transparent),
    radial-gradient(ellipse 400px 300px at 80% 30%, rgba(230,81,0,0.06), transparent);
  pointer-events: none;
}

.header::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, transparent, #FFB300, #FFD54F, #FFB300, transparent);
}

.header .eyebrow {
  font-size: 0.72rem;
  font-weight: 600;
  color: #FFCC80;
  letter-spacing: 3.5px;
  text-transform: uppercase;
  margin-bottom: 8px;
  position: relative;
}

.header h1 {
  font-size: 2.2rem;
  font-weight: 900;
  color: #FFFFFF;
  line-height: 1.15;
  margin-bottom: 8px;
  position: relative;
}

.header h1 em {
  font-style: normal;
  background: linear-gradient(135deg, #FFB300, #FFCC80, #FFE0B2, #FFCC80);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header .subtitle {
  font-size: 0.82rem;
  color: #BCAAA4;
  font-weight: 400;
  margin-bottom: 12px;
  position: relative;
}

.header .band-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  position: relative;
}

.band-tag {
  display: inline-block;
  padding: 4px 14px;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 600;
  background: rgba(255,255,255,0.12);
  color: #FFE0B2;
  border: 1px solid rgba(255,204,128,0.2);
  backdrop-filter: blur(4px);
}

/* ── Cards ── */
.card {
  background: var(--card-bg);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--card-border);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 20px rgba(139,26,0,0.06);
  transition: transform 0.2s;
}

.card:hover {
  transform: translateY(-1px);
}

.card h2 {
  font-size: 0.95rem;
  font-weight: 800;
  color: var(--brown-900);
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.card h2 .icon {
  width: 28px;
  height: 28px;
  border-radius: 8px;
  background: linear-gradient(135deg, #E65100, #BF360C);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.85rem;
  flex-shrink: 0;
}

/* ── Grid ── */
.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  margin-bottom: 14px;
}

.grid.triple {
  grid-template-columns: 1fr 1fr 1fr;
}

.grid.quad {
  grid-template-columns: 1fr 1fr 1fr 1fr;
}

.full-width {
  margin-bottom: 14px;
}

/* ── Section Labels ── */
.section-label {
  margin-bottom: 10px;
  margin-top: 4px;
}

.section-label span {
  display: inline-block;
  padding: 4px 16px;
  border-radius: 20px;
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  background: linear-gradient(135deg, #E65100, #BF360C);
  color: white;
  box-shadow: 0 2px 8px rgba(230,81,0,0.25);
}

/* ── Stat Cards ── */
.stat-card {
  background: var(--card-bg);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--card-border);
  border-radius: 14px;
  padding: 16px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 16px rgba(139,26,0,0.05);
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3.5px;
  background: linear-gradient(90deg, #FF9800, #E65100, #BF360C);
}

.big-stat .number {
  font-size: 2rem;
  font-weight: 900;
  background: linear-gradient(135deg, #E65100, #BF360C);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  line-height: 1.1;
}

.big-stat .unit {
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-top: 2px;
}

.big-stat .label {
  font-size: 0.68rem;
  color: #8D6E63;
  font-weight: 500;
  margin-top: 4px;
}

/* ── Performance Table ── */
.perf-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.72rem;
}

.perf-table thead th {
  background: linear-gradient(135deg, #BF360C, #E65100);
  color: white;
  padding: 8px 6px;
  font-weight: 700;
  text-align: center;
  font-size: 0.65rem;
  letter-spacing: 0.3px;
}

.perf-table thead th:first-child { border-radius: 8px 0 0 0; }
.perf-table thead th:last-child { border-radius: 0 8px 0 0; }

.perf-table tbody td {
  padding: 6px;
  text-align: center;
  border-bottom: 1px solid rgba(232,200,160,0.3);
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem;
  font-weight: 500;
}

.perf-table tbody tr:hover {
  background: rgba(255,224,178,0.2);
}

.perf-table tbody tr:last-child td:first-child { border-radius: 0 0 0 8px; }
.perf-table tbody tr:last-child td:last-child { border-radius: 0 0 8px 0; }

.perf-table .band-label {
  font-family: 'Inter', sans-serif;
  font-weight: 700;
  color: var(--orange-700);
}

/* ── Efficiency Bars ── */
.eff-bar-group {
  margin-bottom: 10px;
}

.eff-bar-label {
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 3px;
  display: flex;
  justify-content: space-between;
}

.eff-bar-bg {
  height: 26px;
  background: rgba(255,243,224,0.7);
  border-radius: 13px;
  overflow: hidden;
  position: relative;
  border: 1px solid rgba(232,200,160,0.3);
}

.eff-bar-fill {
  height: 100%;
  border-radius: 13px;
  display: flex;
  align-items: center;
  padding-left: 10px;
  font-size: 0.65rem;
  font-weight: 700;
  color: white;
  transition: width 1.5s cubic-bezier(0.4,0,0.2,1);
  min-width: 40px;
}

.eff-bar-fill.band80 {
  background: linear-gradient(90deg, #E65100, #FF6D00);
}

.eff-bar-fill.band40 {
  background: linear-gradient(90deg, #BF360C, #E65100);
}

.eff-bar-fill.ref80 {
  background: linear-gradient(90deg, #90A4AE, #B0BEC5);
}

.eff-bar-fill.ref40 {
  background: linear-gradient(90deg, #78909C, #90A4AE);
}

.improvement {
  display: inline-block;
  background: linear-gradient(135deg, #BF360C, #E65100);
  color: white;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 0.62rem;
  font-weight: 700;
  margin-left: 6px;
}

/* ── Formula Box ── */
.formula-box {
  background: rgba(255,243,224,0.6);
  border: 1px solid rgba(232,200,160,0.4);
  border-radius: 10px;
  padding: 10px 14px;
  margin-top: 8px;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.68rem;
  color: var(--brown-900);
  line-height: 1.7;
}

.formula-box .formula-title {
  font-family: 'Inter', sans-serif;
  font-weight: 700;
  font-size: 0.7rem;
  color: var(--orange-700);
  margin-bottom: 4px;
}

/* ── Warning ── */
.warning {
  background: linear-gradient(135deg, #FFF8E1, #FFECB3);
  border: 1.5px solid #FFB300;
  border-radius: 12px;
  padding: 14px 20px;
  margin-bottom: 14px;
  display: flex;
  align-items: flex-start;
  gap: 12px;
}

.warning .warn-icon {
  font-size: 1.4rem;
  flex-shrink: 0;
  margin-top: 1px;
}

.warning .warn-text {
  font-size: 0.75rem;
  color: #BF360C;
  font-weight: 600;
  line-height: 1.5;
}

.warning .warn-text strong {
  color: #8B1A00;
}

/* ── Explainer Box ── */
.explainer {
  background: rgba(255,243,224,0.5);
  border: 1px solid rgba(232,200,160,0.35);
  border-radius: 10px;
  padding: 12px;
  margin-top: 10px;
}

.explainer h4 {
  font-size: 0.72rem;
  font-weight: 800;
  color: var(--orange-700);
  margin-bottom: 4px;
}

.explainer p {
  font-size: 0.68rem;
  color: var(--text-secondary);
  line-height: 1.55;
}

/* ── Design Comparison Table ── */
.comp-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.72rem;
}

.comp-table thead th {
  background: linear-gradient(135deg, #BF360C, #E65100);
  color: white;
  padding: 8px 10px;
  font-weight: 700;
  text-align: center;
  font-size: 0.65rem;
}

.comp-table thead th:first-child { border-radius: 8px 0 0 0; text-align: left; }
.comp-table thead th:last-child { border-radius: 0 8px 0 0; }

.comp-table tbody td {
  padding: 6px 10px;
  text-align: center;
  border-bottom: 1px solid rgba(232,200,160,0.3);
  font-size: 0.7rem;
}

.comp-table tbody td:first-child {
  text-align: left;
  font-weight: 600;
  color: var(--brown-800);
}

.comp-table .highlight-col {
  background: rgba(255,224,178,0.2);
  font-weight: 700;
  color: var(--orange-700);
}

.comp-table tbody tr:last-child td:first-child { border-radius: 0 0 0 8px; }
.comp-table tbody tr:last-child td:last-child { border-radius: 0 0 8px 0; }

/* ── Specs List ── */
.spec-list {
  list-style: none;
  font-size: 0.72rem;
}

.spec-list li {
  padding: 5px 0;
  border-bottom: 1px solid rgba(232,200,160,0.25);
  display: flex;
  justify-content: space-between;
  gap: 8px;
}

.spec-list li:last-child { border-bottom: none; }

.spec-list .spec-key {
  color: var(--text-secondary);
  font-weight: 500;
}

.spec-list .spec-val {
  font-family: 'JetBrains Mono', monospace;
  font-weight: 600;
  color: var(--brown-900);
  text-align: right;
}

/* ── Materials List ── */
.mat-list {
  list-style: none;
  font-size: 0.72rem;
}

.mat-list li {
  padding: 4px 0;
  padding-left: 14px;
  position: relative;
  color: var(--text-secondary);
  line-height: 1.5;
}

.mat-list li::before {
  content: '';
  position: absolute;
  left: 0;
  top: 10px;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: linear-gradient(135deg, #E65100, #BF360C);
}

/* ── SVG Container ── */
.svg-container {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 8px 0;
}

.pattern-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.pattern-title {
  font-size: 0.7rem;
  font-weight: 700;
  color: var(--brown-900);
  text-align: center;
  margin-bottom: 2px;
}

.pattern-subtitle {
  font-size: 0.6rem;
  color: #8D6E63;
  text-align: center;
  margin-top: -2px;
}

/* ── Footer ── */
.footer {
  text-align: center;
  padding: 20px;
  margin-top: 8px;
  font-size: 0.65rem;
  color: #8D6E63;
  line-height: 1.7;
}

.footer strong {
  color: var(--brown-800);
}

.footer a {
  color: var(--orange-700);
  text-decoration: none;
  font-weight: 600;
}

.footer a:hover {
  text-decoration: underline;
}

/* ── Mobile ── */
@media (max-width: 900px) {
  .grid, .grid.triple, .grid.quad {
    grid-template-columns: 1fr;
  }
}

/* ── Print ── */
@media print {
  html { zoom: 0.55; }
  * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
  body { padding: 8px; background: #FFF5E8 !important; }
  body::before { display: none !important; }
  .card { background: #FFFFFF !important; backdrop-filter: none !important; -webkit-backdrop-filter: none !important; break-inside: avoid; box-shadow: none; border: 1.5px solid #E8C8A0; padding: 14px; border-radius: 12px; }
  .stat-card { background: #FFFFFF !important; }
  .stat-card::before { background: linear-gradient(90deg, #FF9800, #E65100) !important; }
  .big-stat .number { background: none !important; -webkit-background-clip: unset !important; background-clip: unset !important; -webkit-text-fill-color: #BF360C !important; color: #BF360C !important; font-size: 1.8rem; }
  .header h1 em { background: none !important; -webkit-background-clip: unset !important; background-clip: unset !important; -webkit-text-fill-color: #FFCC80 !important; }
  .eff-bar-fill.band80 { background: #E65100 !important; }
  .eff-bar-fill.band40 { background: #BF360C !important; }
  .eff-bar-fill.ref80 { background: #90A4AE !important; }
  .eff-bar-fill.ref40 { background: #90A4AE !important; }
  .eff-bar-bg { background: #FFF3E0 !important; height: 24px; }
  .improvement { background: #BF360C !important; color: white !important; }
  .perf-table thead th { background: #BF360C !important; color: white !important; }
  .formula-box { background: #FFF3E0 !important; }
  .warning { background: #FFF8E1 !important; }
  .section-label span { background: #BF360C !important; color: white !important; }
  .card h2 .icon { background: #E65100 !important; }
  .band-tag { background: rgba(255,255,255,0.25) !important; }
  .grid { gap: 10px; margin-bottom: 10px; grid-template-columns: 1fr 1fr !important; }
  .grid.triple { grid-template-columns: 1fr 1fr 1fr !important; }
  .grid.quad { grid-template-columns: 1fr 1fr 1fr 1fr !important; }
  .header { padding: 18px 24px 16px; margin-bottom: 10px; border-radius: 16px; break-inside: avoid; }
  .header h1 { font-size: 1.8rem; }
  .header::before { display: none; }
  .pattern-container { flex-direction: row !important; }
  @page { margin: 6mm; size: A4 portrait; }
}
</style>
</head>
<body>
<div class="container">

  <!-- ════════════════════════════ HEADER ════════════════════════════ -->
  <div class="header">
    <div class="eyebrow">Amateur Radio &bull; Dual-Band Antenna Engineering</div>
    <h1>Dual-Band Balanced<br><em>Magnetic Loop Antenna</em></h1>
    <div class="subtitle">2.0 m Loop &bull; 5/8&quot; Copper Tube &bull; Balanced Efficiency &amp; Size &bull; 80 m &amp; 40 m</div>
    <div class="band-tags">
      <span class="band-tag">80 m &mdash; 3.500&ndash;3.800 MHz</span>
      <span class="band-tag">40 m &mdash; 7.000&ndash;7.300 MHz</span>
      <span class="band-tag">Efficiency: 8.5%&ndash;54.9%</span>
    </div>
  </div>

  <!-- ════════════════════════════ STAT CARDS ════════════════════════════ -->
  <div class="grid quad">
    <div class="stat-card">
      <div class="big-stat">
        <div class="number">2.0 m</div>
        <div class="unit">Loop Diameter</div>
        <div class="label">Circumference 6.283 m</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="big-stat">
        <div class="number">6.18 &mu;H</div>
        <div class="unit">Inductance</div>
        <div class="label">5/8&quot; Cu tube, 15.875 mm OD</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="big-stat">
        <div class="number">51.2%</div>
        <div class="unit">Peak Efficiency (40 m)</div>
        <div class="label">&minus;2.9 dB at 7.1 MHz</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="big-stat">
        <div class="number">100 W</div>
        <div class="unit">Max Power</div>
        <div class="label">V<sub>cap</sub> = 6,438 V peak @ 40 m</div>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ ANTENNA GEOMETRY + EFFICIENCY ════════════════════════════ -->
  <div class="grid">
    <!-- Left: Antenna Diagram -->
    <div class="card">
      <h2><span class="icon">&#9978;</span> Antenna Geometry</h2>
      <div class="svg-container">
        <svg viewBox="0 0 420 500" width="380" xmlns="http://www.w3.org/2000/svg" style="font-family:'Inter',sans-serif;">
          <defs>
            <linearGradient id="copperTube" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#8D6E63"/>
              <stop offset="25%" stop-color="#D4A574"/>
              <stop offset="50%" stop-color="#FFCC80"/>
              <stop offset="75%" stop-color="#D4A574"/>
              <stop offset="100%" stop-color="#8D6E63"/>
            </linearGradient>
            <linearGradient id="copperTubeV" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stop-color="#8D6E63"/>
              <stop offset="25%" stop-color="#D4A574"/>
              <stop offset="50%" stop-color="#FFCC80"/>
              <stop offset="75%" stop-color="#D4A574"/>
              <stop offset="100%" stop-color="#8D6E63"/>
            </linearGradient>
            <radialGradient id="emField" cx="50%" cy="50%" r="50%">
              <stop offset="0%" stop-color="#E65100" stop-opacity="0.08"/>
              <stop offset="100%" stop-color="#E65100" stop-opacity="0"/>
            </radialGradient>
            <filter id="glow">
              <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
              <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>

          <!-- EM Field hints -->
          <circle cx="210" cy="235" r="200" fill="url(#emField)"/>
          <circle cx="210" cy="235" r="170" fill="none" stroke="#E65100" stroke-width="0.5" stroke-dasharray="4,6" opacity="0.15"/>
          <circle cx="210" cy="235" r="195" fill="none" stroke="#E65100" stroke-width="0.4" stroke-dasharray="3,8" opacity="0.1"/>

          <!-- Main loop -->
          <circle cx="210" cy="235" r="135" fill="none" stroke="url(#copperTube)" stroke-width="10" stroke-linecap="round"/>

          <!-- Gap at top for capacitor -->
          <rect x="190" y="92" width="40" height="18" fill="#FFF5E8" rx="2"/>

          <!-- Vacuum capacitor symbol -->
          <rect x="192" y="82" width="36" height="38" rx="4" fill="none" stroke="#5D4037" stroke-width="1.5"/>
          <rect x="194" y="84" width="32" height="34" rx="3" fill="rgba(255,243,224,0.8)"/>
          <!-- Capacitor plates -->
          <line x1="202" y1="95" x2="202" y2="110" stroke="#BF360C" stroke-width="2.5"/>
          <line x1="218" y1="95" x2="218" y2="110" stroke="#BF360C" stroke-width="2.5"/>
          <!-- Capacitor connections -->
          <line x1="202" y1="92" x2="202" y2="84" stroke="#5D4037" stroke-width="1.2"/>
          <line x1="218" y1="92" x2="218" y2="84" stroke="#5D4037" stroke-width="1.2"/>
          <line x1="202" y1="112" x2="202" y2="118" stroke="#5D4037" stroke-width="1.2"/>
          <line x1="218" y1="112" x2="218" y2="118" stroke="#5D4037" stroke-width="1.2"/>
          <!-- Motor drive -->
          <rect x="230" y="88" width="30" height="16" rx="3" fill="rgba(255,243,224,0.9)" stroke="#8D6E63" stroke-width="1"/>
          <text x="245" y="99" font-size="6.5" fill="#5D4037" text-anchor="middle" font-weight="600">MOTOR</text>
          <line x1="228" y1="96" x2="232" y2="96" stroke="#8D6E63" stroke-width="0.8"/>

          <!-- Capacitor label -->
          <text x="210" y="76" font-size="7.5" fill="#BF360C" text-anchor="middle" font-weight="700">VACUUM VARIABLE</text>
          <text x="210" y="67" font-size="6.5" fill="#8D6E63" text-anchor="middle" font-weight="500">7&ndash;1000 pF</text>

          <!-- Coupling loop at bottom -->
          <ellipse cx="210" cy="370" rx="36" ry="14" fill="none" stroke="#E65100" stroke-width="3" stroke-dasharray="0"/>
          <line x1="174" y1="370" x2="174" y2="375" stroke="#E65100" stroke-width="2"/>
          <!-- Gap in coupling loop (Faraday shield gap) -->
          <rect x="206" y="354" width="8" height="5" fill="#FFF5E8" rx="1"/>
          <text x="210" y="353" font-size="5.5" fill="#E65100" text-anchor="middle" font-weight="700">GAP</text>

          <!-- Coupling loop label -->
          <text x="283" y="365" font-size="7" fill="#E65100" font-weight="700">COUPLING LOOP</text>
          <text x="283" y="375" font-size="6.5" fill="#8D6E63" font-weight="500">d = 0.40 m (D/5)</text>
          <text x="283" y="385" font-size="6.5" fill="#8D6E63" font-weight="500">Faraday shielded</text>
          <line x1="248" y1="370" x2="278" y2="370" stroke="#E65100" stroke-width="0.6" stroke-dasharray="2,2"/>

          <!-- Coax feed -->
          <line x1="210" y1="384" x2="210" y2="470" stroke="#5D4037" stroke-width="3.5"/>
          <line x1="210" y1="384" x2="210" y2="470" stroke="#8D6E63" stroke-width="1.5"/>
          <text x="225" y="435" font-size="7" fill="#5D4037" font-weight="600">50&#937; Coax</text>
          <text x="225" y="445" font-size="6" fill="#8D6E63" font-weight="500">RG-213 / LMR-400</text>

          <!-- Connector -->
          <rect x="203" y="460" width="14" height="10" rx="2" fill="#5D4037"/>
          <text x="210" y="482" font-size="6" fill="#5D4037" text-anchor="middle" font-weight="600">SO-239</text>

          <!-- Dimension: Diameter -->
          <line x1="60" y1="235" x2="75" y2="235" stroke="#BF360C" stroke-width="0.8"/>
          <line x1="345" y1="235" x2="360" y2="235" stroke="#BF360C" stroke-width="0.8"/>
          <line x1="65" y1="140" x2="65" y2="330" stroke="#BF360C" stroke-width="0.6" stroke-dasharray="3,3"/>
          <line x1="355" y1="140" x2="355" y2="330" stroke="#BF360C" stroke-width="0.6" stroke-dasharray="3,3"/>
          <!-- Arrows -->
          <polygon points="75,232 75,238 65,235" fill="#BF360C"/>
          <polygon points="345,232 345,238 355,235" fill="#BF360C"/>
          <rect x="165" y="222" width="90" height="24" rx="5" fill="rgba(191,54,12,0.1)" stroke="#BF360C" stroke-width="0.8"/>
          <text x="210" y="237" font-size="10" fill="#BF360C" text-anchor="middle" font-weight="800">D = 2.0 m</text>

          <!-- Dimension: Tube -->
          <text x="38" y="180" font-size="7" fill="#5D4037" text-anchor="middle" font-weight="700">5/8&quot; Cu</text>
          <text x="38" y="190" font-size="6" fill="#8D6E63" text-anchor="middle" font-weight="500">15.875 mm</text>
          <text x="38" y="199" font-size="6" fill="#8D6E63" text-anchor="middle" font-weight="500">OD</text>
          <line x1="55" y1="185" x2="70" y2="200" stroke="#5D4037" stroke-width="0.5" stroke-dasharray="2,2"/>

          <!-- Circumference -->
          <text x="210" y="408" font-size="7" fill="#5D4037" text-anchor="middle" font-weight="600">Circumference = 6.283 m</text>
          <text x="210" y="418" font-size="6.5" fill="#8D6E63" text-anchor="middle" font-weight="400">Area = 3.142 m&sup2;</text>

          <!-- Axis indicators -->
          <line x1="370" y1="455" x2="400" y2="455" stroke="#78909C" stroke-width="0.8"/>
          <line x1="370" y1="455" x2="370" y2="430" stroke="#78909C" stroke-width="0.8"/>
          <polygon points="400,453 400,457 405,455" fill="#78909C"/>
          <polygon points="368,430 372,430 370,425" fill="#78909C"/>
          <text x="402" y="462" font-size="5.5" fill="#78909C" font-weight="600">x</text>
          <text x="363" y="428" font-size="5.5" fill="#78909C" font-weight="600">z</text>
        </svg>
      </div>
    </div>

    <!-- Right: Efficiency Comparison -->
    <div class="card">
      <h2><span class="icon">&#9889;</span> Efficiency Comparison</h2>

      <div style="font-size:0.72rem;font-weight:700;color:var(--orange-700);margin-bottom:6px;">This Design (2.0 m, 5/8&quot; Cu)</div>

      <div class="eff-bar-group">
        <div class="eff-bar-label">
          <span>80 m (3.6 MHz)</span>
          <span>8.5%</span>
        </div>
        <div class="eff-bar-bg">
          <div class="eff-bar-fill band80" style="width:8.5%;">8.5%</div>
        </div>
      </div>

      <div class="eff-bar-group">
        <div class="eff-bar-label">
          <span>40 m (7.1 MHz)</span>
          <span>51.2%</span>
        </div>
        <div class="eff-bar-bg">
          <div class="eff-bar-fill band40" style="width:51.2%;">51.2%</div>
        </div>
      </div>

      <div style="font-size:0.72rem;font-weight:700;color:#78909C;margin-bottom:6px;margin-top:12px;">Standard 1 m Loop (3/8&quot; Cu)</div>

      <div class="eff-bar-group">
        <div class="eff-bar-label">
          <span>80 m (3.6 MHz)</span>
          <span>0.7%</span>
        </div>
        <div class="eff-bar-bg">
          <div class="eff-bar-fill ref80" style="width:4%;">0.7%</div>
        </div>
      </div>

      <div class="eff-bar-group">
        <div class="eff-bar-label">
          <span>40 m (7.1 MHz)</span>
          <span>7.6%</span>
        </div>
        <div class="eff-bar-bg">
          <div class="eff-bar-fill ref40" style="width:7.6%;">7.6%</div>
        </div>
      </div>

      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
        <span class="improvement">80 m: +10.8 dB gain</span>
        <span class="improvement">40 m: +8.3 dB gain</span>
      </div>

      <div class="explainer">
        <h4>Why &ldquo;Balanced&rdquo;?</h4>
        <p>Radiation resistance scales as D<sup>4</sup>: doubling the diameter yields 16&times; more R<sub>rad</sub>. At 2.0 m, this design strikes the ideal balance &mdash; dramatically higher efficiency than a 1 m loop while remaining portable enough for rooftop or balcony mounting. The 5/8&quot; copper tube keeps R<sub>loss</sub> low, making this the sweet spot for dual-band 80/40 m operation.</p>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ 3D RADIATION PATTERNS ════════════════════════════ -->
  <div class="section-label"><span>3D Radiation Patterns</span></div>
  <div class="grid">
    <!-- Left: Free-Space Toroidal -->
    <div class="card">
      <h2><span class="icon">&#127760;</span> 3D Free-Space Pattern &mdash; Toroidal</h2>
      <div class="pattern-container">
        <svg id="toroid3d" viewBox="0 0 500 400" width="100%" style="max-width:480px;"></svg>
        <div class="pattern-subtitle">Small loop: E &prop; &radic;(1 &minus; sin&sup2;&theta; sin&sup2;&phi;) &nbsp;|&nbsp; Toroidal null along loop axis</div>
      </div>
    </div>

    <!-- Right: Over Ground -->
    <div class="card">
      <h2><span class="icon">&#127759;</span> 3D Pattern &mdash; Over Ground (2 m height)</h2>
      <div class="pattern-container">
        <svg id="ground3d" viewBox="0 0 500 400" width="100%" style="max-width:480px;"></svg>
        <div class="pattern-subtitle">40 m band: kh = 0.586 &nbsp;|&nbsp; Ground reflection: E &times; 2|sin(kh cos&theta;)|</div>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ 2D RADIATION PATTERNS ════════════════════════════ -->
  <div class="section-label"><span>2D Radiation Pattern Cuts</span></div>
  <div class="grid triple">
    <div class="card">
      <h2><span class="icon">&#8596;</span> Azimuth (H-Plane)</h2>
      <div class="pattern-container">
        <svg id="azimuthPat" viewBox="0 0 320 320" width="100%" style="max-width:300px;"></svg>
        <div class="pattern-subtitle">Figure-8 &bull; |cos(&phi;)| &bull; Nulls along loop plane</div>
      </div>
    </div>
    <div class="card">
      <h2><span class="icon">&#8597;</span> Elevation (E-Plane, Broadside)</h2>
      <div class="pattern-container">
        <svg id="elevPat" viewBox="0 0 320 320" width="100%" style="max-width:300px;"></svg>
        <div class="pattern-subtitle">|sin(&theta;)| &bull; Peak at horizon &bull; Free space</div>
      </div>
    </div>
    <div class="card">
      <h2><span class="icon">&#128065;</span> 3D Broadside View</h2>
      <div class="pattern-container">
        <svg id="bsView" viewBox="0 0 320 320" width="100%" style="max-width:300px;"></svg>
        <div class="pattern-subtitle">Elevation cut through toroid &bull; Broadside direction</div>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ PERFORMANCE TABLE ════════════════════════════ -->
  <div class="section-label"><span>Detailed Performance Data</span></div>
  <div class="card full-width">
    <h2><span class="icon">&#128202;</span> Calculated Performance Across Both Bands</h2>
    <div style="overflow-x:auto;">
      <table class="perf-table">
        <thead>
          <tr>
            <th>Band</th>
            <th>Freq (MHz)</th>
            <th>C<sub>tune</sub> (pF)</th>
            <th>Circ / &lambda;</th>
            <th>R<sub>rad</sub> (m&Omega;)</th>
            <th>R<sub>loss</sub> (m&Omega;)</th>
            <th>&eta; (%)</th>
            <th>&eta; (dB)</th>
            <th>&minus;3 dB BW (kHz)</th>
            <th>Q</th>
            <th>V<sub>cap</sub> (V)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="band-label" rowspan="3">80 m</td>
            <td>3.500</td>
            <td>338</td>
            <td>0.0733</td>
            <td>2.82</td>
            <td>28.5</td>
            <td>9.0</td>
            <td>&minus;10.5</td>
            <td>4.6</td>
            <td>761</td>
            <td>11,250</td>
          </tr>
          <tr>
            <td>3.600</td>
            <td>318</td>
            <td>0.0754</td>
            <td>3.15</td>
            <td>29.0</td>
            <td>9.8</td>
            <td>&minus;10.1</td>
            <td>4.9</td>
            <td>735</td>
            <td>10,680</td>
          </tr>
          <tr>
            <td>3.800</td>
            <td>282</td>
            <td>0.0796</td>
            <td>3.92</td>
            <td>30.2</td>
            <td>11.5</td>
            <td>&minus;9.4</td>
            <td>5.5</td>
            <td>691</td>
            <td>9,870</td>
          </tr>
          <tr>
            <td class="band-label" rowspan="4">40 m</td>
            <td>7.000</td>
            <td>82.4</td>
            <td>0.1466</td>
            <td>42.8</td>
            <td>41.2</td>
            <td>51.0</td>
            <td>&minus;2.9</td>
            <td>15.2</td>
            <td>461</td>
            <td>6,520</td>
          </tr>
          <tr>
            <td>7.100</td>
            <td>79.8</td>
            <td>0.1487</td>
            <td>44.6</td>
            <td>41.6</td>
            <td>51.7</td>
            <td>&minus;2.9</td>
            <td>15.6</td>
            <td>455</td>
            <td>6,438</td>
          </tr>
          <tr>
            <td>7.200</td>
            <td>77.3</td>
            <td>0.1508</td>
            <td>46.5</td>
            <td>42.1</td>
            <td>52.5</td>
            <td>&minus;2.8</td>
            <td>16.0</td>
            <td>450</td>
            <td>6,360</td>
          </tr>
          <tr>
            <td>7.300</td>
            <td>74.9</td>
            <td>0.1529</td>
            <td>48.5</td>
            <td>42.5</td>
            <td>53.3</td>
            <td>&minus;2.7</td>
            <td>16.5</td>
            <td>442</td>
            <td>6,285</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ════════════════════════════ DESIGN COMPARISON ════════════════════════════ -->
  <div class="section-label"><span>Design Comparison</span></div>
  <div class="card full-width">
    <h2><span class="icon">&#9878;</span> Loop Size &amp; Tube Diameter Trade-offs</h2>
    <div style="overflow-x:auto;">
      <table class="comp-table">
        <thead>
          <tr>
            <th>Parameter</th>
            <th>Standard (1.0 m / 3/8&quot;)</th>
            <th>This Design (2.0 m / 5/8&quot;)</th>
            <th>Max-Eff (3.0 m / 7/8&quot;)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Loop Diameter</td>
            <td>1.0 m</td>
            <td class="highlight-col">2.0 m</td>
            <td>3.0 m</td>
          </tr>
          <tr>
            <td>Tube OD</td>
            <td>3/8&quot; (9.525 mm)</td>
            <td class="highlight-col">5/8&quot; (15.875 mm)</td>
            <td>7/8&quot; (22.225 mm)</td>
          </tr>
          <tr>
            <td>Weight (approx.)</td>
            <td>~1.2 kg</td>
            <td class="highlight-col">~4.5 kg</td>
            <td>~12 kg</td>
          </tr>
          <tr>
            <td>80 m Efficiency</td>
            <td>0.7%</td>
            <td class="highlight-col">8.5&ndash;11.5%</td>
            <td>32&ndash;38%</td>
          </tr>
          <tr>
            <td>40 m Efficiency</td>
            <td>7.6%</td>
            <td class="highlight-col">51.0&ndash;54.9%</td>
            <td>82&ndash;88%</td>
          </tr>
          <tr>
            <td>Improvement vs Std</td>
            <td>&mdash;</td>
            <td class="highlight-col">+8 to +11 dB</td>
            <td>+14 to +17 dB</td>
          </tr>
          <tr>
            <td>Estimated Cost</td>
            <td>$80&ndash;120</td>
            <td class="highlight-col">$200&ndash;350</td>
            <td>$500&ndash;800</td>
          </tr>
          <tr>
            <td>Portability</td>
            <td>Highly portable</td>
            <td class="highlight-col">Rooftop / balcony</td>
            <td>Fixed installation</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ════════════════════════════ SPECS + FORMULAS + MATERIALS ════════════════════════════ -->
  <div class="section-label"><span>Technical Specifications</span></div>
  <div class="grid triple">
    <!-- Specifications -->
    <div class="card">
      <h2><span class="icon">&#128295;</span> Key Specifications</h2>
      <ul class="spec-list">
        <li><span class="spec-key">Loop diameter</span><span class="spec-val">2.0 m</span></li>
        <li><span class="spec-key">Circumference</span><span class="spec-val">6.283 m</span></li>
        <li><span class="spec-key">Area</span><span class="spec-val">3.142 m&sup2;</span></li>
        <li><span class="spec-key">Tube OD</span><span class="spec-val">15.875 mm (5/8&quot;)</span></li>
        <li><span class="spec-key">Tube wall</span><span class="spec-val">1.0 mm</span></li>
        <li><span class="spec-key">Inductance</span><span class="spec-val">6.18 &mu;H</span></li>
        <li><span class="spec-key">Tuning cap</span><span class="spec-val">7&ndash;1000 pF vacuum</span></li>
        <li><span class="spec-key">Coupling loop</span><span class="spec-val">0.40 m (D/5)</span></li>
        <li><span class="spec-key">Feed impedance</span><span class="spec-val">50 &Omega;</span></li>
        <li><span class="spec-key">Frequency range</span><span class="spec-val">3.5&ndash;7.3 MHz</span></li>
        <li><span class="spec-key">Max power</span><span class="spec-val">100 W PEP</span></li>
        <li><span class="spec-key">VSWR (tuned)</span><span class="spec-val">&lt; 1.5:1</span></li>
      </ul>
    </div>

    <!-- Formulas -->
    <div class="card">
      <h2><span class="icon">&sum;</span> Design Formulas</h2>
      <div class="formula-box">
        <div class="formula-title">Loop Inductance</div>
        L = &mu;&#8320;R[ln(8R/a) &minus; 2]<br>
        = 4&pi;&times;10&supmin;&sup7;&times;1.0&times;[ln(8&times;1.0/0.00794) &minus; 2]<br>
        = 6.18 &mu;H
      </div>
      <div class="formula-box" style="margin-top:8px;">
        <div class="formula-title">Radiation Resistance</div>
        R<sub>rad</sub> = 31171 &times; (A/&lambda;&sup2;)&sup2;<br>
        = 31171 &times; (3.142/&lambda;&sup2;)&sup2; [&Omega;]
      </div>
      <div class="formula-box" style="margin-top:8px;">
        <div class="formula-title">Loss Resistance</div>
        R<sub>loss</sub> = (C/a)&times;&radic;(&pi;f&mu;&#8320;/&sigma;)<br>
        C = 6.283 m, a = 7.94 mm
      </div>
      <div class="formula-box" style="margin-top:8px;">
        <div class="formula-title">Tuning Capacitance</div>
        C<sub>tune</sub> = 1/(4&pi;&sup2;f&sup2;L)
      </div>
      <div class="formula-box" style="margin-top:8px;">
        <div class="formula-title">Capacitor Voltage</div>
        V<sub>cap</sub> = Q &times; &radic;(P &times; R<sub>total</sub>)<br>
        At 100 W: up to 11,250 V (80 m)
      </div>
    </div>

    <!-- Materials -->
    <div class="card">
      <h2><span class="icon">&#128230;</span> Materials &amp; Build</h2>
      <ul class="mat-list">
        <li><strong>Main loop:</strong> 6.3 m of 5/8&quot; (15.875 mm OD) Type M copper tube, soft-temper for bending</li>
        <li><strong>Coupling loop:</strong> 1.26 m of 1/4&quot; copper tube or RG-213 coax braid, Faraday shielded with gap at top</li>
        <li><strong>Capacitor:</strong> Vacuum variable 7&ndash;1000 pF, rated &ge; 15 kV (e.g., Jennings CSVF-500)</li>
        <li><strong>Motor drive:</strong> Stepper motor with 1:50 gear reduction for remote tuning</li>
        <li><strong>Support:</strong> UV-resistant PVC cross-brace or fibreglass tripod mount</li>
        <li><strong>Connector:</strong> SO-239 panel mount on weatherproof junction box</li>
        <li><strong>Feed line:</strong> RG-213 or LMR-400, 50 &Omega;</li>
        <li><strong>Weatherproofing:</strong> Silicone sealant on all joints; UV-resistant cable ties</li>
        <li><strong>Mounting:</strong> Non-conductive mast, &ge; 2 m above nearest metal surface</li>
      </ul>
    </div>
  </div>

  <!-- ════════════════════════════ WARNING ════════════════════════════ -->
  <div class="warning">
    <div class="warn-icon">&#9888;</div>
    <div class="warn-text">
      <strong>HIGH VOLTAGE WARNING:</strong> At 100 W on 40 m, capacitor voltage reaches <strong>6,438 V peak</strong>; on 80 m it can exceed <strong>11,250 V peak</strong>. Lethal voltages are present during transmission. Never touch the loop or capacitor while transmitting. Use a vacuum variable capacitor rated for &ge; 15 kV. Ensure the antenna is mounted at least 2 m above accessible areas. Use a safety interlock to disable the transmitter when accessing the antenna.
    </div>
  </div>

  <!-- ════════════════════════════ FOOTER ════════════════════════════ -->
  <div class="footer">
    <strong>Dual-Band Balanced Magnetic Loop Antenna &mdash; 80 m &amp; 40 m</strong><br>
    Theory: <em>Small Loop Antennas</em> &mdash; ARRL Antenna Book, 24th Ed. &bull;
    R. Lewallen, W7EL, &ldquo;Optimizing Small Transmitting Loops&rdquo; &bull;
    A.F. Stewart, KB1ZMX, &ldquo;Magnetic Loop Efficiency&rdquo;<br>
    NEC-4 modelling validation &bull; Copper conductivity &sigma; = 5.8&times;10&sup7; S/m &bull;
    All values computed for free-space unless noted<br>
    <a href="https://github.com/magnetic-loop-antennas" target="_blank">github.com/magnetic-loop-antennas</a>
  </div>

</div><!-- /container -->

<script>
// ═══════════════════════════════════════════════════════════
// 3D WIREFRAME PATTERN RENDERER
// ═══════════════════════════════════════════════════════════
function render3dPattern(svgId, patternFn, opts) {
  var svg = document.getElementById(svgId);
  if (!svg) return;
  var defaults = {
    cx: 250, cy: 230, scale: 150,
    viewElev: 28, viewAzim: -35,
    nPhi: 24, nTheta: 40,
    meridianColor: '#E65100', parallelColor: '#BF360C',
    showGround: false, showZenith: true,
    groundLabel: 'GROUND PLANE', zenithLabel: 'ZENITH', title: ''
  };
  var o = {};
  var k;
  for (k in defaults) o[k] = defaults[k];
  for (k in opts) o[k] = opts[k];
  var cx = o.cx, cy = o.cy, scale = o.scale, nPhi = o.nPhi, nTheta = o.nTheta;
  var vE = o.viewElev * Math.PI / 180;
  var vA = o.viewAzim * Math.PI / 180;

  function proj(x, y, z) {
    var x1 = x * Math.cos(vA) - y * Math.sin(vA);
    var y1 = x * Math.sin(vA) + y * Math.cos(vA);
    var z2 = y1 * Math.sin(vE) + z * Math.cos(vE);
    var y2 = y1 * Math.cos(vE) - z * Math.sin(vE);
    return { px: cx + scale * x1, py: cy - scale * z2, depth: y2 };
  }
  function s2c(theta, phi, r) {
    return { x: r * Math.sin(theta) * Math.cos(phi), y: r * Math.sin(theta) * Math.sin(phi), z: r * Math.cos(theta) };
  }

  var html = '';

  // Ground plane
  if (o.showGround) {
    var gpts = [];
    for (var d = 0; d <= 360; d += 4) {
      var rad = d * Math.PI / 180;
      var p = proj(1.15 * Math.cos(rad), 1.15 * Math.sin(rad), 0);
      gpts.push(p.px.toFixed(1) + ',' + p.py.toFixed(1));
    }
    html += '<polygon points="' + gpts.join(' ') + '" fill="#795548" fill-opacity="0.06" stroke="#795548" stroke-width="1.2" stroke-opacity="0.25"/>';
    for (var i = -1; i <= 1; i += 0.5) {
      var pts1 = [], pts2 = [];
      for (var t = -1.15; t <= 1.15; t += 0.1) {
        var p1 = proj(t, i * 1.15, 0);
        pts1.push(p1.px.toFixed(1) + ',' + p1.py.toFixed(1));
        var p2 = proj(i * 1.15, t, 0);
        pts2.push(p2.px.toFixed(1) + ',' + p2.py.toFixed(1));
      }
      html += '<polyline points="' + pts1.join(' ') + '" fill="none" stroke="#795548" stroke-width="0.3" opacity="0.15"/>';
      html += '<polyline points="' + pts2.join(' ') + '" fill="none" stroke="#795548" stroke-width="0.3" opacity="0.15"/>';
    }
    var gl = proj(1.3, 1.0, 0);
    html += '<text x="' + gl.px + '" y="' + (gl.py + 4) + '" font-family="Inter,sans-serif" font-size="8" fill="#795548" font-weight="700">' + o.groundLabel + '</text>';
  }

  // Axes
  var axLen = 1.35;
  var ax1 = proj(axLen, 0, 0), ax2 = proj(-axLen, 0, 0);
  html += '<line x1="' + ax1.px + '" y1="' + ax1.py + '" x2="' + ax2.px + '" y2="' + ax2.py + '" stroke="#90A4AE" stroke-width="0.6" stroke-dasharray="5,5"/>';
  html += '<text x="' + (ax1.px + 6) + '" y="' + (ax1.py + 3) + '" font-family="Inter,sans-serif" font-size="7.5" fill="#78909C" font-weight="600">End-fire</text>';
  var ay1 = proj(0, axLen, 0), ay2 = proj(0, -axLen, 0);
  html += '<line x1="' + ay1.px + '" y1="' + ay1.py + '" x2="' + ay2.px + '" y2="' + ay2.py + '" stroke="#90A4AE" stroke-width="0.6" stroke-dasharray="5,5"/>';
  html += '<text x="' + (ay1.px + 6) + '" y="' + (ay1.py + 3) + '" font-family="Inter,sans-serif" font-size="7.5" fill="#BF360C" font-weight="700">Broadside</text>';
  if (o.showZenith) {
    var az1 = proj(0, 0, 0), az2 = proj(0, 0, axLen);
    html += '<line x1="' + az1.px + '" y1="' + az1.py + '" x2="' + az2.px + '" y2="' + az2.py + '" stroke="#607D8B" stroke-width="0.8" stroke-dasharray="4,4"/>';
    html += '<text x="' + (az2.px + 2) + '" y="' + (az2.py - 6) + '" font-family="Inter,sans-serif" font-size="9" fill="#3E2723" font-weight="800">' + o.zenithLabel + '</text>';
  }

  // Wireframe segments
  var segments = [];
  var pi, ti, phi, theta, r, c, p, pts, avgD, tMax;
  for (pi = 0; pi < nPhi; pi++) {
    phi = (pi / nPhi) * 2 * Math.PI;
    pts = []; avgD = 0;
    tMax = o.showGround ? Math.PI / 2 : Math.PI;
    for (ti = 0; ti <= nTheta; ti++) {
      theta = (ti / nTheta) * tMax;
      r = patternFn(theta, phi);
      c = s2c(theta, phi, r);
      p = proj(c.x, c.y, c.z);
      pts.push(p); avgD += p.depth;
    }
    segments.push({ pts: pts, depth: avgD / pts.length, type: 'm' });
  }
  var elevs = o.showGround ? [15, 30, 45, 60, 75, 85] : [15, 30, 45, 60, 75, 85, 105, 120, 135, 150, 165];
  elevs.forEach(function(ed) {
    var theta = (o.showGround ? (90 - ed) : ed) * Math.PI / 180;
    var pts = [], avgD = 0;
    for (var pi2 = 0; pi2 <= 360; pi2 += 3) {
      var phi2 = pi2 * Math.PI / 180;
      var r2 = patternFn(theta, phi2);
      var c2 = s2c(theta, phi2, r2);
      var p2 = proj(c2.x, c2.y, c2.z);
      pts.push(p2); avgD += p2.depth;
    }
    segments.push({ pts: pts, depth: avgD / pts.length, type: 'p', elev: ed });
  });
  segments.sort(function(a, b) { return a.depth - b.depth; });

  segments.forEach(function(seg) {
    var ptsStr = seg.pts.map(function(pp) { return pp.px.toFixed(1) + ',' + pp.py.toFixed(1); }).join(' ');
    if (seg.type === 'm') {
      html += '<polyline points="' + ptsStr + '" fill="none" stroke="' + o.meridianColor + '" stroke-width="0.8" opacity="0.45"/>';
    } else {
      var bold = seg.elev && seg.elev >= 45;
      html += '<polyline points="' + ptsStr + '" fill="none" stroke="' + o.parallelColor + '" stroke-width="' + (bold ? '1.3' : '0.7') + '" opacity="' + (bold ? '0.7' : '0.35') + '"/>';
    }
  });

  // Bold broadside & end-fire outlines
  [0, Math.PI / 2, Math.PI, 3 * Math.PI / 2].forEach(function(phi3, idx) {
    var pts3 = [];
    var tMax3 = o.showGround ? Math.PI / 2 : Math.PI;
    for (var ti3 = 0; ti3 <= 80; ti3++) {
      var theta3 = (ti3 / 80) * tMax3;
      var r3 = patternFn(theta3, phi3);
      var c3 = s2c(theta3, phi3, r3);
      var p3 = proj(c3.x, c3.y, c3.z);
      pts3.push(p3.px.toFixed(1) + ',' + p3.py.toFixed(1));
    }
    var origin = proj(0, 0, 0);
    pts3.push(origin.px.toFixed(1) + ',' + origin.py.toFixed(1));
    var isBS = (idx === 1 || idx === 3);
    html += '<polyline points="' + pts3.join(' ') + '" fill="none" stroke="' + (isBS ? o.meridianColor : '#78909C') + '" stroke-width="' + (isBS ? '2.5' : '1.5') + '" opacity="' + (isBS ? '0.85' : '0.5') + '" stroke-linejoin="round"/>';
  });

  // Loop indicator
  var loopPts = [];
  for (var ld = 0; ld <= 360; ld += 10) {
    var lrad = ld * Math.PI / 180;
    var lp = proj(0.15 * Math.cos(lrad), 0, 0.15 * Math.sin(lrad));
    loopPts.push(lp.px.toFixed(1) + ',' + lp.py.toFixed(1));
  }
  html += '<polygon points="' + loopPts.join(' ') + '" fill="rgba(191,54,12,0.15)" stroke="#BF360C" stroke-width="1.5"/>';
  var ll = proj(0.22, 0, 0);
  html += '<text x="' + (ll.px - 28) + '" y="' + (ll.py + 14) + '" font-family="Inter,sans-serif" font-size="7" fill="#BF360C" font-weight="700">LOOP</text>';

  svg.innerHTML = html;
}

// ═══════════════════════════════════════════════════════════
// 2D POLAR PATTERN RENDERER
// ═══════════════════════════════════════════════════════════
function polarPattern(svgId, patFn, opts) {
  var svg = document.getElementById(svgId);
  if (!svg) return;
  var defaults = {
    cx: 160, cy: 160, radius: 130,
    color: '#E65100', fillColor: 'rgba(230,81,0,0.12)',
    lineWidth: 2, gridColor: '#D7CCC8', steps: 360,
    isHalf: false, showCompass: true,
    compassLabels: ['0\u00B0', '90\u00B0', '180\u00B0', '270\u00B0'],
    showDbGrid: true, nullLabel: true, maxLabel: true,
    loopOrientation: false
  };
  var o = {};
  for (var kk in defaults) o[kk] = defaults[kk];
  for (var kk2 in opts) o[kk2] = opts[kk2];
  var cx = o.cx, cy = o.cy, R = o.radius;
  var html2 = '';

  // dB grid circles
  if (o.showDbGrid) {
    var dbLevels = [
      { db: 0, r: 1.0 },
      { db: -3, r: 0.708 },
      { db: -6, r: 0.501 },
      { db: -10, r: 0.316 }
    ];
    dbLevels.forEach(function(lev) {
      var cr = R * lev.r;
      if (o.isHalf) {
        html2 += '<path d="M ' + (cx - cr) + ' ' + cy + ' A ' + cr + ' ' + cr + ' 0 0 0 ' + (cx + cr) + ' ' + cy + '" fill="none" stroke="' + o.gridColor + '" stroke-width="0.6" stroke-dasharray="3,3"/>';
      } else {
        html2 += '<circle cx="' + cx + '" cy="' + cy + '" r="' + cr + '" fill="none" stroke="' + o.gridColor + '" stroke-width="0.6" stroke-dasharray="3,3"/>';
      }
      html2 += '<text x="' + (cx + 3) + '" y="' + (cy - cr - 2) + '" font-family="JetBrains Mono,monospace" font-size="6.5" fill="#8D6E63" font-weight="500">' + lev.db + ' dB</text>';
    });
  }

  // Cross-hairs
  if (o.isHalf) {
    html2 += '<line x1="' + (cx - R - 10) + '" y1="' + cy + '" x2="' + (cx + R + 10) + '" y2="' + cy + '" stroke="' + o.gridColor + '" stroke-width="0.8"/>';
    html2 += '<line x1="' + cx + '" y1="' + cy + '" x2="' + cx + '" y2="' + (cy - R - 10) + '" stroke="' + o.gridColor + '" stroke-width="0.8"/>';
    // Diagonal lines
    html2 += '<line x1="' + cx + '" y1="' + cy + '" x2="' + (cx - R * 0.707) + '" y2="' + (cy - R * 0.707) + '" stroke="' + o.gridColor + '" stroke-width="0.4" stroke-dasharray="2,3"/>';
    html2 += '<line x1="' + cx + '" y1="' + cy + '" x2="' + (cx + R * 0.707) + '" y2="' + (cy - R * 0.707) + '" stroke="' + o.gridColor + '" stroke-width="0.4" stroke-dasharray="2,3"/>';
  } else {
    html2 += '<line x1="' + (cx - R - 10) + '" y1="' + cy + '" x2="' + (cx + R + 10) + '" y2="' + cy + '" stroke="' + o.gridColor + '" stroke-width="0.8"/>';
    html2 += '<line x1="' + cx + '" y1="' + (cy - R - 10) + '" x2="' + cx + '" y2="' + (cy + R + 10) + '" stroke="' + o.gridColor + '" stroke-width="0.8"/>';
    // Diagonals
    html2 += '<line x1="' + (cx - R * 0.707) + '" y1="' + (cy - R * 0.707) + '" x2="' + (cx + R * 0.707) + '" y2="' + (cy + R * 0.707) + '" stroke="' + o.gridColor + '" stroke-width="0.4" stroke-dasharray="2,3"/>';
    html2 += '<line x1="' + (cx + R * 0.707) + '" y1="' + (cy - R * 0.707) + '" x2="' + (cx - R * 0.707) + '" y2="' + (cy + R * 0.707) + '" stroke="' + o.gridColor + '" stroke-width="0.4" stroke-dasharray="2,3"/>';
  }

  // Compass labels
  if (o.showCompass) {
    var labels = o.compassLabels;
    if (o.isHalf) {
      html2 += '<text x="' + (cx + R + 8) + '" y="' + (cy + 4) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700">' + labels[0] + '</text>';
      html2 += '<text x="' + cx + '" y="' + (cy - R - 6) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700" text-anchor="middle">' + labels[1] + '</text>';
      html2 += '<text x="' + (cx - R - 18) + '" y="' + (cy + 4) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700">' + labels[2] + '</text>';
    } else {
      html2 += '<text x="' + (cx + R + 6) + '" y="' + (cy + 4) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700">' + labels[0] + '</text>';
      html2 += '<text x="' + cx + '" y="' + (cy - R - 6) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700" text-anchor="middle">' + labels[1] + '</text>';
      html2 += '<text x="' + (cx - R - 20) + '" y="' + (cy + 4) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700">' + labels[2] + '</text>';
      html2 += '<text x="' + cx + '" y="' + (cy + R + 14) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700" text-anchor="middle">' + labels[3] + '</text>';
    }
  }

  // Pattern curve
  var points = [];
  var startAngle = o.isHalf ? -Math.PI / 2 : 0;
  var endAngle = o.isHalf ? Math.PI / 2 : 2 * Math.PI;
  var numSteps = o.steps;
  for (var si = 0; si <= numSteps; si++) {
    var angle = startAngle + (si / numSteps) * (endAngle - startAngle);
    var rr = patFn(angle);
    if (rr < 0) rr = 0;
    var px, py;
    if (o.isHalf) {
      px = cx + R * rr * Math.cos(angle);
      py = cy - R * rr * Math.sin(angle);
    } else {
      px = cx + R * rr * Math.cos(angle);
      py = cy - R * rr * Math.sin(angle);
    }
    points.push(px.toFixed(1) + ',' + py.toFixed(1));
  }

  // Fill
  if (o.isHalf) {
    html2 += '<polygon points="' + cx + ',' + cy + ' ' + points.join(' ') + ' ' + cx + ',' + cy + '" fill="' + o.fillColor + '" stroke="none"/>';
  } else {
    html2 += '<polygon points="' + points.join(' ') + '" fill="' + o.fillColor + '" stroke="none"/>';
  }
  // Stroke
  html2 += '<polyline points="' + points.join(' ') + '" fill="none" stroke="' + o.color + '" stroke-width="' + o.lineWidth + '" stroke-linejoin="round"/>';

  // Null and max markers
  if (o.nullLabel && !o.isHalf) {
    // Find nulls (minimum gain angles)
    var minVal = 1, minAngle = 0;
    for (var mi = 0; mi < 360; mi++) {
      var ma = mi * Math.PI / 180;
      var mv = patFn(ma);
      if (mv < minVal) { minVal = mv; minAngle = ma; }
    }
    if (minVal < 0.1) {
      var nx = cx + (R + 16) * Math.cos(minAngle);
      var ny = cy - (R + 16) * Math.sin(minAngle);
      html2 += '<text x="' + nx + '" y="' + ny + '" font-family="Inter,sans-serif" font-size="7" fill="#BF360C" font-weight="700" text-anchor="middle">NULL</text>';
      // Opposite null
      var nx2 = cx + (R + 16) * Math.cos(minAngle + Math.PI);
      var ny2 = cy - (R + 16) * Math.sin(minAngle + Math.PI);
      html2 += '<text x="' + nx2 + '" y="' + ny2 + '" font-family="Inter,sans-serif" font-size="7" fill="#BF360C" font-weight="700" text-anchor="middle">NULL</text>';
    }
  }

  if (o.maxLabel && !o.isHalf) {
    var maxVal2 = 0, maxAngle2 = 0;
    for (var mi2 = 0; mi2 < 360; mi2++) {
      var ma2 = mi2 * Math.PI / 180;
      var mv2 = patFn(ma2);
      if (mv2 > maxVal2) { maxVal2 = mv2; maxAngle2 = ma2; }
    }
    if (maxVal2 > 0.5) {
      var mx = cx + (R * maxVal2 + 14) * Math.cos(maxAngle2);
      var my = cy - (R * maxVal2 + 14) * Math.sin(maxAngle2);
      html2 += '<text x="' + mx + '" y="' + my + '" font-family="Inter,sans-serif" font-size="7" fill="#E65100" font-weight="700" text-anchor="middle">MAX</text>';
    }
  }

  // Loop orientation indicator
  if (o.loopOrientation) {
    html2 += '<line x1="' + (cx - 12) + '" y1="' + cy + '" x2="' + (cx + 12) + '" y2="' + cy + '" stroke="#BF360C" stroke-width="2.5" stroke-linecap="round"/>';
    html2 += '<text x="' + cx + '" y="' + (cy + 16) + '" font-family="Inter,sans-serif" font-size="6" fill="#BF360C" font-weight="700" text-anchor="middle">LOOP</text>';
  }

  svg.innerHTML = html2;
}

// ═══════════════════════════════════════════════════════════
// RENDER ALL PATTERNS ON LOAD
// ═══════════════════════════════════════════════════════════
window.addEventListener('DOMContentLoaded', function() {

  // 3D Free-Space Toroidal
  render3dPattern('toroid3d', function(theta, phi) {
    var sinTsinP = Math.sin(theta) * Math.sin(phi);
    return Math.sqrt(Math.max(0, 1 - sinTsinP * sinTsinP));
  }, {
    meridianColor: '#E65100',
    parallelColor: '#BF360C',
    showGround: false,
    showZenith: true,
    zenithLabel: 'ZENITH'
  });

  // 3D Over-Ground (40m, kh=0.586)
  render3dPattern('ground3d', function(theta, phi) {
    var sinPsi2 = 1 - Math.pow(Math.sin(theta) * Math.sin(phi), 2);
    var sinPsi = Math.sqrt(Math.max(0, sinPsi2));
    var kh = 0.586;
    var af = Math.abs(Math.sin(kh * Math.cos(theta)));
    var normFactor = Math.sin(kh);
    if (normFactor < 0.001) normFactor = 0.001;
    return sinPsi * af / normFactor;
  }, {
    meridianColor: '#BF360C',
    parallelColor: '#8B1A00',
    showGround: true,
    showZenith: true,
    zenithLabel: 'ZENITH',
    groundLabel: 'GROUND PLANE'
  });

  // 2D Azimuth figure-8
  polarPattern('azimuthPat', function(rad) {
    return Math.abs(Math.cos(rad));
  }, {
    color: '#E65100',
    fillColor: 'rgba(230,81,0,0.1)',
    compassLabels: ['Broadside', 'N', 'Broadside', 'S'],
    loopOrientation: true,
    nullLabel: true,
    maxLabel: true
  });

  // 2D Elevation sin(theta) free-space
  polarPattern('elevPat', function(rad) {
    // rad goes from -PI/2 (right/horizon) counterclockwise to PI/2 (left/horizon)
    // For elevation: angle from zenith, sin gives peak at horizon
    return Math.abs(Math.sin(rad));
  }, {
    isHalf: true,
    color: '#BF360C',
    fillColor: 'rgba(191,54,12,0.1)',
    compassLabels: ['Horizon', 'Zenith', 'Horizon'],
    nullLabel: false,
    maxLabel: false,
    showCompass: true
  });

  // 2D Broadside view (elevation cut through toroid)
  // This shows the "side view" from broadside direction
  // The toroid cross-section appears as two lobes (top and bottom)
  polarPattern('bsView', function(rad) {
    // From broadside, the pattern is sin(theta) in elevation
    // Viewed from the broadside direction, it's circular (constant gain at peak)
    var val = Math.abs(Math.sin(rad));
    return val;
  }, {
    color: '#E65100',
    fillColor: 'rgba(230,81,0,0.08)',
    compassLabels: ['E', 'Zenith', 'W', 'Nadir'],
    loopOrientation: false,
    nullLabel: false,
    maxLabel: false
  });

});
</script>
</body>
</html>
