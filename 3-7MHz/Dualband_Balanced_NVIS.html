<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dual-Band Balanced NVIS Magnetic Loop Antenna — 80 m &amp; 40 m</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --orange-600: #E65100;
  --orange-700: #BF360C;
  --orange-800: #8B1A00;
  --brown-900: #3E2723;
  --brown-800: #4E342E;
  --brown-700: #5D4037;
  --brown-600: #6D4C41;
  --gold: #FFB300;
  --card-bg: rgba(255,255,255,0.82);
  --card-border: rgba(232,200,160,0.5);
  --text-primary: #3E2723;
  --text-secondary: #5D4037;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(160deg, #FFF8F0 0%, #FFECD2 20%, #FFE0B2 40%, #FFE8CC 60%, #FFF0DB 80%, #FFF5E8 100%);
  color: var(--text-primary);
  padding: 20px;
  min-height: 100vh;
  position: relative;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background:
    radial-gradient(1.5px 1.5px at 15% 25%, rgba(230,81,0,0.12) 50%, transparent 50%),
    radial-gradient(1px 1px at 45% 15%, rgba(191,54,12,0.08) 50%, transparent 50%),
    radial-gradient(2px 2px at 75% 35%, rgba(230,81,0,0.1) 50%, transparent 50%),
    radial-gradient(1px 1px at 25% 65%, rgba(191,54,12,0.06) 50%, transparent 50%),
    radial-gradient(1.5px 1.5px at 85% 75%, rgba(230,81,0,0.09) 50%, transparent 50%),
    radial-gradient(1px 1px at 55% 85%, rgba(191,54,12,0.07) 50%, transparent 50%);
  pointer-events: none;
  z-index: 0;
  animation: particleDrift 25s ease-in-out infinite alternate;
}

@keyframes particleDrift {
  0% { transform: translate(0, 0); }
  25% { transform: translate(-8px, 5px); }
  50% { transform: translate(5px, -8px); }
  75% { transform: translate(-3px, -5px); }
  100% { transform: translate(8px, 3px); }
}

.container {
  max-width: 1100px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

/* ── Header ── */
.header {
  background: linear-gradient(135deg, #3E2723 0%, #4E342E 30%, #5D4037 60%, #6D4C41 100%);
  border-radius: 20px;
  padding: 28px 36px 24px;
  margin-bottom: 16px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(62,39,35,0.3);
}

.header::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background:
    radial-gradient(ellipse 600px 200px at 20% 50%, rgba(255,179,0,0.08), transparent),
    radial-gradient(ellipse 400px 300px at 80% 30%, rgba(230,81,0,0.06), transparent);
  pointer-events: none;
}

.header::after {
  content: '';
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, transparent, #FFB300, #FFD54F, #FFB300, transparent);
}

.header .eyebrow {
  font-size: 0.72rem;
  font-weight: 600;
  color: #FFCC80;
  letter-spacing: 3.5px;
  text-transform: uppercase;
  margin-bottom: 8px;
  position: relative;
}

.header h1 {
  font-size: 2.2rem;
  font-weight: 900;
  color: #FFFFFF;
  line-height: 1.15;
  margin-bottom: 8px;
  position: relative;
}

.header h1 em {
  font-style: normal;
  background: linear-gradient(135deg, #FFB300, #FFCC80, #FFE0B2, #FFCC80);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header .subtitle {
  font-size: 0.82rem;
  color: #BCAAA4;
  font-weight: 400;
  margin-bottom: 12px;
  position: relative;
}

.header .band-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  position: relative;
}

.band-tag {
  display: inline-block;
  padding: 4px 14px;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 600;
  background: rgba(255,255,255,0.12);
  color: #FFE0B2;
  border: 1px solid rgba(255,204,128,0.2);
  backdrop-filter: blur(4px);
}

/* ── Cards ── */
.card {
  background: var(--card-bg);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--card-border);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 20px rgba(139,26,0,0.06);
  transition: transform 0.2s;
}

.card:hover { transform: translateY(-1px); }

.card h2 {
  font-size: 0.95rem;
  font-weight: 800;
  color: var(--brown-900);
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.card h2 .icon {
  width: 28px;
  height: 28px;
  border-radius: 8px;
  background: linear-gradient(135deg, #E65100, #BF360C);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.85rem;
  flex-shrink: 0;
}

/* ── Grid ── */
.grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; margin-bottom: 14px; }
.grid.triple { grid-template-columns: 1fr 1fr 1fr; }
.grid.quad { grid-template-columns: 1fr 1fr 1fr 1fr; }
.full-width { margin-bottom: 14px; }

/* ── Section Labels ── */
.section-label { margin-bottom: 10px; margin-top: 4px; }
.section-label span {
  display: inline-block;
  padding: 4px 16px;
  border-radius: 20px;
  font-size: 0.68rem;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  background: linear-gradient(135deg, #E65100, #BF360C);
  color: white;
  box-shadow: 0 2px 8px rgba(230,81,0,0.25);
}

/* ── Stat Cards ── */
.stat-card {
  background: var(--card-bg);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1px solid var(--card-border);
  border-radius: 14px;
  padding: 16px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 16px rgba(139,26,0,0.05);
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3.5px;
  background: linear-gradient(90deg, #FF9800, #E65100, #BF360C);
}

.big-stat .number {
  font-size: 2rem;
  font-weight: 900;
  background: linear-gradient(135deg, #E65100, #BF360C);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  line-height: 1.1;
}

.big-stat .unit { font-size: 0.7rem; font-weight: 600; color: var(--text-secondary); margin-top: 2px; }
.big-stat .label { font-size: 0.68rem; color: #8D6E63; font-weight: 500; margin-top: 4px; }

/* ── Performance Table ── */
.perf-table { width: 100%; border-collapse: collapse; font-size: 0.72rem; }
.perf-table thead th {
  background: linear-gradient(135deg, #BF360C, #E65100);
  color: white; padding: 8px 6px; font-weight: 700; text-align: center; font-size: 0.65rem; letter-spacing: 0.3px;
}
.perf-table thead th:first-child { border-radius: 8px 0 0 0; }
.perf-table thead th:last-child { border-radius: 0 8px 0 0; }
.perf-table tbody td {
  padding: 6px; text-align: center; border-bottom: 1px solid rgba(232,200,160,0.3);
  font-family: 'JetBrains Mono', monospace; font-size: 0.68rem; font-weight: 500;
}
.perf-table tbody tr:hover { background: rgba(255,224,178,0.2); }
.perf-table tbody tr:last-child td:first-child { border-radius: 0 0 0 8px; }
.perf-table tbody tr:last-child td:last-child { border-radius: 0 0 8px 0; }
.perf-table .band-label { font-family: 'Inter', sans-serif; font-weight: 700; color: var(--orange-700); }

/* ── Efficiency Bars ── */
.eff-bar-group { margin-bottom: 10px; }
.eff-bar-label { font-size: 0.7rem; font-weight: 600; color: var(--text-primary); margin-bottom: 3px; display: flex; justify-content: space-between; }
.eff-bar-bg { height: 26px; background: rgba(255,243,224,0.7); border-radius: 13px; overflow: hidden; position: relative; border: 1px solid rgba(232,200,160,0.3); }
.eff-bar-fill { height: 100%; border-radius: 13px; display: flex; align-items: center; padding-left: 10px; font-size: 0.65rem; font-weight: 700; color: white; transition: width 1.5s cubic-bezier(0.4,0,0.2,1); min-width: 40px; }
.eff-bar-fill.band80 { background: linear-gradient(90deg, #E65100, #FF6D00); }
.eff-bar-fill.band40 { background: linear-gradient(90deg, #BF360C, #E65100); }
.eff-bar-fill.ref80 { background: linear-gradient(90deg, #90A4AE, #B0BEC5); }
.eff-bar-fill.ref40 { background: linear-gradient(90deg, #78909C, #90A4AE); }
.improvement { display: inline-block; background: linear-gradient(135deg, #BF360C, #E65100); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.62rem; font-weight: 700; margin-left: 6px; }

/* ── Formula Box ── */
.formula-box { background: rgba(255,243,224,0.6); border: 1px solid rgba(232,200,160,0.4); border-radius: 10px; padding: 10px 14px; margin-top: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.68rem; color: var(--brown-900); line-height: 1.7; }
.formula-box .formula-title { font-family: 'Inter', sans-serif; font-weight: 700; font-size: 0.7rem; color: var(--orange-700); margin-bottom: 4px; }

/* ── Warning ── */
.warning { background: linear-gradient(135deg, #FFF8E1, #FFECB3); border: 1.5px solid #FFB300; border-radius: 12px; padding: 14px 20px; margin-bottom: 14px; display: flex; align-items: flex-start; gap: 12px; }
.warning .warn-icon { font-size: 1.4rem; flex-shrink: 0; margin-top: 1px; }
.warning .warn-text { font-size: 0.75rem; color: #BF360C; font-weight: 600; line-height: 1.5; }
.warning .warn-text strong { color: #8B1A00; }

/* ── Explainer Box ── */
.explainer { background: rgba(255,243,224,0.5); border: 1px solid rgba(232,200,160,0.35); border-radius: 10px; padding: 12px; margin-top: 10px; }
.explainer h4 { font-size: 0.72rem; font-weight: 800; color: var(--orange-700); margin-bottom: 4px; }
.explainer p { font-size: 0.68rem; color: var(--text-secondary); line-height: 1.55; }

/* ── Design Comparison Table ── */
.comp-table { width: 100%; border-collapse: collapse; font-size: 0.72rem; }
.comp-table thead th { background: linear-gradient(135deg, #BF360C, #E65100); color: white; padding: 8px 10px; font-weight: 700; text-align: center; font-size: 0.65rem; }
.comp-table thead th:first-child { border-radius: 8px 0 0 0; text-align: left; }
.comp-table thead th:last-child { border-radius: 0 8px 0 0; }
.comp-table tbody td { padding: 6px 10px; text-align: center; border-bottom: 1px solid rgba(232,200,160,0.3); font-size: 0.7rem; }
.comp-table tbody td:first-child { text-align: left; font-weight: 600; color: var(--brown-800); }
.comp-table .highlight-col { background: rgba(255,224,178,0.2); font-weight: 700; color: var(--orange-700); }
.comp-table tbody tr:last-child td:first-child { border-radius: 0 0 0 8px; }
.comp-table tbody tr:last-child td:last-child { border-radius: 0 0 8px 0; }

/* ── Specs List ── */
.spec-list { list-style: none; font-size: 0.72rem; }
.spec-list li { padding: 5px 0; border-bottom: 1px solid rgba(232,200,160,0.25); display: flex; justify-content: space-between; gap: 8px; }
.spec-list li:last-child { border-bottom: none; }
.spec-list .spec-key { color: var(--text-secondary); font-weight: 500; }
.spec-list .spec-val { font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--brown-900); text-align: right; }

/* ── Materials List ── */
.mat-list { list-style: none; font-size: 0.72rem; }
.mat-list li { padding: 4px 0; padding-left: 14px; position: relative; color: var(--text-secondary); line-height: 1.5; }
.mat-list li::before { content: ''; position: absolute; left: 0; top: 10px; width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #E65100, #BF360C); }

/* ── SVG Container ── */
.svg-container { display: flex; justify-content: center; align-items: center; padding: 8px 0; }
.pattern-container { display: flex; flex-direction: column; align-items: center; gap: 4px; }
.pattern-title { font-size: 0.7rem; font-weight: 700; color: var(--brown-900); text-align: center; margin-bottom: 2px; }
.pattern-subtitle { font-size: 0.6rem; color: #8D6E63; text-align: center; margin-top: -2px; }

/* ── Footer ── */
.footer { text-align: center; padding: 20px; margin-top: 8px; font-size: 0.65rem; color: #8D6E63; line-height: 1.7; }
.footer strong { color: var(--brown-800); }
.footer a { color: var(--orange-700); text-decoration: none; font-weight: 600; }
.footer a:hover { text-decoration: underline; }

/* ── Mobile ── */
@media (max-width: 900px) {
  .grid, .grid.triple, .grid.quad { grid-template-columns: 1fr; }
}

/* ── Print ── */
@media print {
  html { zoom: 0.55; }
  * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
  body { padding: 8px; background: #FFF5E8 !important; }
  body::before { display: none !important; }
  .card { background: #FFFFFF !important; backdrop-filter: none !important; -webkit-backdrop-filter: none !important; break-inside: avoid; box-shadow: none; border: 1.5px solid #E8C8A0; padding: 14px; border-radius: 12px; }
  .stat-card { background: #FFFFFF !important; }
  .stat-card::before { background: linear-gradient(90deg, #FF9800, #E65100) !important; }
  .big-stat .number { background: none !important; -webkit-background-clip: unset !important; background-clip: unset !important; -webkit-text-fill-color: #BF360C !important; color: #BF360C !important; font-size: 1.8rem; }
  .header h1 em { background: none !important; -webkit-background-clip: unset !important; background-clip: unset !important; -webkit-text-fill-color: #FFCC80 !important; }
  .eff-bar-fill.band80 { background: #E65100 !important; }
  .eff-bar-fill.band40 { background: #BF360C !important; }
  .eff-bar-fill.ref80 { background: #90A4AE !important; }
  .eff-bar-fill.ref40 { background: #90A4AE !important; }
  .eff-bar-bg { background: #FFF3E0 !important; height: 24px; }
  .improvement { background: #BF360C !important; color: white !important; }
  .perf-table thead th { background: #BF360C !important; color: white !important; }
  .comp-table thead th { background: #BF360C !important; color: white !important; }
  .formula-box { background: #FFF3E0 !important; }
  .warning { background: #FFF8E1 !important; }
  .section-label span { background: #BF360C !important; color: white !important; }
  .card h2 .icon { background: #E65100 !important; }
  .band-tag { background: rgba(255,255,255,0.25) !important; }
  .grid { gap: 10px; margin-bottom: 10px; grid-template-columns: 1fr 1fr !important; }
  .grid.triple { grid-template-columns: 1fr 1fr 1fr !important; }
  .grid.quad { grid-template-columns: 1fr 1fr 1fr 1fr !important; }
  .header { padding: 18px 24px 16px; margin-bottom: 10px; border-radius: 16px; break-inside: avoid; }
  .header h1 { font-size: 1.8rem; }
  .header::before { display: none; }
  .pattern-container { flex-direction: row !important; }
  @page { margin: 6mm; size: A4 portrait; }
}
</style>
</head>
<body>
<div class="container">

  <!-- ════════════════════════════ HEADER ════════════════════════════ -->
  <div class="header">
    <div class="eyebrow">Amateur Radio &bull; NVIS Antenna Engineering &bull; Regional Coverage</div>
    <h1>Dual-Band Balanced NVIS<br><em>Magnetic Loop Antenna</em></h1>
    <div class="subtitle">2.0 m Loop &bull; 5/8&quot; Copper Tube &bull; Near-Vertical Incidence Skywave &bull; 80 m &amp; 40 m</div>
    <div class="band-tags">
      <span class="band-tag">80 m &mdash; 3.500&ndash;3.800 MHz</span>
      <span class="band-tag">40 m &mdash; 7.000&ndash;7.300 MHz</span>
      <span class="band-tag">NVIS: 0&ndash;500 km Regional</span>
      <span class="band-tag">Peak Radiation at Zenith</span>
    </div>
  </div>

  <!-- ════════════════════════════ STAT CARDS ════════════════════════════ -->
  <div class="grid quad">
    <div class="stat-card">
      <div class="big-stat">
        <div class="number">5.0 m</div>
        <div class="unit">Centre Height</div>
        <div class="label">Loop centre above ground</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="big-stat">
        <div class="number">90&deg;</div>
        <div class="unit">Peak Elevation</div>
        <div class="label">NVIS cone: 45&deg;&ndash;90&deg;</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="big-stat">
        <div class="number">51.2%</div>
        <div class="unit">Peak Efficiency (40 m)</div>
        <div class="label">&minus;2.9 dB at 7.0 MHz</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="big-stat">
        <div class="number">0&ndash;500</div>
        <div class="unit">Coverage (km)</div>
        <div class="label">Regional NVIS via F2-layer</div>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ NVIS MOUNTING + EFFICIENCY ════════════════════════════ -->
  <div class="grid">
    <!-- Left: NVIS Mounting Diagram -->
    <div class="card">
      <h2><span class="icon">&#9978;</span> NVIS Mounting &mdash; Side View</h2>
      <div class="svg-container">
        <svg viewBox="0 0 420 540" width="380" xmlns="http://www.w3.org/2000/svg" style="font-family:'Inter',sans-serif;">
          <defs>
            <linearGradient id="copperTube" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#8D6E63"/>
              <stop offset="25%" stop-color="#D4A574"/>
              <stop offset="50%" stop-color="#FFCC80"/>
              <stop offset="75%" stop-color="#D4A574"/>
              <stop offset="100%" stop-color="#8D6E63"/>
            </linearGradient>
            <linearGradient id="mastGrad" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#90A4AE"/>
              <stop offset="40%" stop-color="#B0BEC5"/>
              <stop offset="100%" stop-color="#90A4AE"/>
            </linearGradient>
            <marker id="arrowUp" markerWidth="8" markerHeight="6" refX="4" refY="6" orient="auto">
              <polygon points="0,6 4,0 8,6" fill="#E65100"/>
            </marker>
          </defs>

          <!-- Zenith arrow -->
          <line x1="210" y1="55" x2="210" y2="10" stroke="#E65100" stroke-width="2.5" marker-end="url(#arrowUp)"/>
          <text x="210" y="8" text-anchor="middle" font-size="9" fill="#E65100" font-weight="900" letter-spacing="2">ZENITH</text>
          <text x="210" y="67" text-anchor="middle" font-size="7" fill="#BF360C" font-weight="600">(peak radiation)</text>

          <!-- Mast -->
          <rect x="203" y="75" width="14" height="400" rx="3" fill="url(#mastGrad)" stroke="#78909C" stroke-width="1"/>
          <text x="195" y="460" text-anchor="end" font-size="7" fill="#546E7A" font-weight="600" transform="rotate(-90,195,460)">FIBREGLASS MAST (min 6 m)</text>

          <!-- Main loop (vertical, centre at ~250) -->
          <circle cx="210" cy="255" r="100" fill="none" stroke="url(#copperTube)" stroke-width="8" stroke-linecap="round"/>

          <!-- Capacitor at top -->
          <rect x="194" y="148" width="32" height="20" rx="4" fill="rgba(255,243,224,0.9)" stroke="#5D4037" stroke-width="1.2"/>
          <text x="210" y="161" text-anchor="middle" font-size="6.5" fill="#BF360C" font-weight="700">CAP</text>
          <text x="260" y="152" font-size="7" fill="#BF360C" font-weight="700">VACUUM VAR</text>
          <text x="260" y="162" font-size="6" fill="#8D6E63" font-weight="500">84&ndash;335 pF</text>

          <!-- Coupling loop at bottom -->
          <ellipse cx="210" cy="355" rx="28" ry="12" fill="none" stroke="#E65100" stroke-width="3"/>
          <text x="260" y="352" font-size="7" fill="#E65100" font-weight="700">COUPLING LOOP</text>
          <text x="260" y="362" font-size="6" fill="#8D6E63">0.40 m, Faraday shielded</text>

          <!-- Coax down mast -->
          <line x1="210" y1="367" x2="210" y2="475" stroke="#5D4037" stroke-width="3"/>
          <text x="230" y="430" font-size="6.5" fill="#5D4037" font-weight="600">50&Omega; Coax</text>

          <!-- Ground level -->
          <line x1="30" y1="475" x2="390" y2="475" stroke="#6D4C41" stroke-width="2"/>
          <rect x="30" y="475" width="360" height="15" fill="#8D6E63" opacity="0.1"/>
          <text x="380" y="488" text-anchor="end" font-size="7" fill="#6D4C41" font-weight="700">GROUND</text>

          <!-- Ground screen -->
          <line x1="90" y1="490" x2="330" y2="490" stroke="#795548" stroke-width="1.2" stroke-dasharray="4,3"/>
          <line x1="120" y1="498" x2="300" y2="498" stroke="#795548" stroke-width="0.8" stroke-dasharray="3,4"/>
          <line x1="150" y1="505" x2="270" y2="505" stroke="#795548" stroke-width="0.6" stroke-dasharray="2,4"/>
          <text x="210" y="520" text-anchor="middle" font-size="7.5" fill="#795548" font-weight="700">GROUND SCREEN</text>
          <text x="210" y="530" text-anchor="middle" font-size="6.5" fill="#A1887F">4 m &times; 4 m chicken wire or radials</text>

          <!-- Height dimension: 5.0m centre -->
          <line x1="395" y1="255" x2="395" y2="475" stroke="#3E2723" stroke-width="0.8"/>
          <line x1="390" y1="255" x2="400" y2="255" stroke="#3E2723" stroke-width="0.8"/>
          <line x1="390" y1="475" x2="400" y2="475" stroke="#3E2723" stroke-width="0.8"/>
          <rect x="380" y="352" width="38" height="28" rx="4" fill="white" stroke="#E8C8A0" stroke-width="0.5"/>
          <text x="399" y="364" text-anchor="middle" font-size="9" fill="#3E2723" font-weight="800">5.0 m</text>
          <text x="399" y="374" text-anchor="middle" font-size="6" fill="#5D4037" font-weight="600">CENTRE</text>

          <!-- Bottom clearance: 4.0m -->
          <line x1="42" y1="355" x2="42" y2="475" stroke="#3E2723" stroke-width="0.8"/>
          <line x1="37" y1="355" x2="47" y2="355" stroke="#3E2723" stroke-width="0.8"/>
          <line x1="37" y1="475" x2="47" y2="475" stroke="#3E2723" stroke-width="0.8"/>
          <rect x="25" y="405" width="38" height="28" rx="4" fill="white" stroke="#E8C8A0" stroke-width="0.5"/>
          <text x="44" y="417" text-anchor="middle" font-size="9" fill="#3E2723" font-weight="800">4.0 m</text>
          <text x="44" y="427" text-anchor="middle" font-size="5.5" fill="#E65100" font-weight="700">CLEAR</text>

          <!-- Loop diameter dimension -->
          <line x1="110" y1="250" x2="110" y2="260" stroke="#3E2723" stroke-width="0.8"/>
          <line x1="310" y1="250" x2="310" y2="260" stroke="#3E2723" stroke-width="0.8"/>
          <line x1="110" y1="255" x2="150" y2="255" stroke="#3E2723" stroke-width="0.7"/>
          <line x1="310" y1="255" x2="270" y2="255" stroke="#3E2723" stroke-width="0.7"/>
          <rect x="165" y="244" width="90" height="20" rx="5" fill="rgba(191,54,12,0.1)" stroke="#BF360C" stroke-width="0.8"/>
          <text x="210" y="258" text-anchor="middle" font-size="9" fill="#BF360C" font-weight="800">D = 2.0 m</text>

          <!-- Tube spec -->
          <text x="75" y="200" text-anchor="middle" font-size="7" fill="#5D4037" font-weight="700">5/8&quot; Cu</text>
          <text x="75" y="210" text-anchor="middle" font-size="6" fill="#8D6E63">15.875 mm OD</text>

          <!-- NVIS radiation arrows (upward) -->
          <path d="M 160 120 Q 170 85, 150 50" fill="none" stroke="#E65100" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>
          <path d="M 260 120 Q 250 85, 270 50" fill="none" stroke="#E65100" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>
          <path d="M 130 180 Q 110 140, 90 80" fill="none" stroke="#E65100" stroke-width="0.8" stroke-dasharray="3,3" opacity="0.35"/>
          <path d="M 290 180 Q 310 140, 330 80" fill="none" stroke="#E65100" stroke-width="0.8" stroke-dasharray="3,3" opacity="0.35"/>
        </svg>
      </div>
    </div>

    <!-- Right: Efficiency + NVIS Explanation -->
    <div class="card">
      <h2><span class="icon">&#9889;</span> Efficiency (Unchanged)</h2>

      <div style="font-size:0.72rem;font-weight:700;color:var(--orange-700);margin-bottom:6px;">This Design (2.0 m, 5/8&quot; Cu)</div>

      <div class="eff-bar-group">
        <div class="eff-bar-label"><span>80 m (3.6 MHz)</span><span>8.5%</span></div>
        <div class="eff-bar-bg"><div class="eff-bar-fill band80" style="width:8.5%;">8.5%</div></div>
      </div>
      <div class="eff-bar-group">
        <div class="eff-bar-label"><span>40 m (7.1 MHz)</span><span>51.2%</span></div>
        <div class="eff-bar-bg"><div class="eff-bar-fill band40" style="width:51.2%;">51.2%</div></div>
      </div>

      <div style="font-size:0.72rem;font-weight:700;color:#78909C;margin-bottom:6px;margin-top:12px;">Standard 1 m Loop (3/8&quot; Cu)</div>

      <div class="eff-bar-group">
        <div class="eff-bar-label"><span>80 m (3.6 MHz)</span><span>0.7%</span></div>
        <div class="eff-bar-bg"><div class="eff-bar-fill ref80" style="width:4%;">0.7%</div></div>
      </div>
      <div class="eff-bar-group">
        <div class="eff-bar-label"><span>40 m (7.1 MHz)</span><span>7.6%</span></div>
        <div class="eff-bar-bg"><div class="eff-bar-fill ref40" style="width:7.6%;">7.6%</div></div>
      </div>

      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;">
        <span class="improvement">80 m: +10.8 dB gain</span>
        <span class="improvement">40 m: +8.3 dB gain</span>
      </div>

      <div class="explainer">
        <h4>Why NVIS?</h4>
        <p>A vertical magnetic loop has its magnetic moment <strong>horizontal</strong>. At height h &lt; &lambda;/4, ground reflection constructively enhances radiation at zenith while suppressing horizon radiation &mdash; perfect for <strong>regional coverage within 500 km</strong>. The antenna hardware is <strong>identical</strong>; only the mounting height and ground screen change.</p>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ 3D RADIATION PATTERNS ════════════════════════════ -->
  <div class="section-label"><span>3D NVIS Radiation Patterns</span></div>
  <div class="grid">
    <div class="card">
      <h2><span class="icon">&#127759;</span> 3D NVIS Pattern &mdash; Over Ground (5 m)</h2>
      <div class="pattern-container">
        <svg id="nvis3d" viewBox="0 0 500 400" width="100%" style="max-width:480px;"></svg>
        <div class="pattern-subtitle">40 m band: kh = 0.734 &nbsp;|&nbsp; Ground reflection: E &times; 2|sin(kh&middot;cos&theta;)| &nbsp;|&nbsp; Peak at zenith</div>
      </div>
    </div>
    <div class="card">
      <h2><span class="icon">&#127760;</span> 3D Free-Space Pattern &mdash; Toroidal (Reference)</h2>
      <div class="pattern-container">
        <svg id="toroid3d" viewBox="0 0 500 400" width="100%" style="max-width:480px;"></svg>
        <div class="pattern-subtitle">Small loop free-space: E &prop; &radic;(1 &minus; sin&sup2;&theta;&middot;sin&sup2;&phi;) &nbsp;|&nbsp; Toroidal null along loop axis</div>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ NVIS ELEVATION PATTERN DATA ════════════════════════════ -->
  <div class="section-label"><span>NVIS Elevation Pattern &amp; Coverage</span></div>
  <div class="grid">
    <div class="card">
      <h2><span class="icon">&#128202;</span> Normalised Elevation Pattern (Broadside, PEC Ground)</h2>
      <div style="overflow-x:auto;">
        <table class="perf-table">
          <thead>
            <tr><th>Elevation</th><th>80 m E<sub>norm</sub></th><th>80 m (dB)</th><th>40 m E<sub>norm</sub></th><th>40 m (dB)</th></tr>
          </thead>
          <tbody>
            <tr><td class="band-label">90&deg; (zenith)</td><td>1.000</td><td>0.0</td><td>1.000</td><td>0.0</td></tr>
            <tr><td>80&deg;</td><td>0.985</td><td>&minus;0.1</td><td>0.989</td><td>&minus;0.1</td></tr>
            <tr><td>70&deg;</td><td>0.942</td><td>&minus;0.5</td><td>0.952</td><td>&minus;0.4</td></tr>
            <tr><td>60&deg;</td><td>0.872</td><td>&minus;1.2</td><td>0.887</td><td>&minus;1.0</td></tr>
            <tr><td>50&deg;</td><td>0.774</td><td>&minus;2.2</td><td>0.796</td><td>&minus;2.0</td></tr>
            <tr><td>45&deg;</td><td>0.716</td><td>&minus;2.9</td><td>0.742</td><td>&minus;2.6</td></tr>
            <tr><td>30&deg;</td><td>0.509</td><td>&minus;5.9</td><td>0.536</td><td>&minus;5.4</td></tr>
            <tr><td>20&deg;</td><td>0.349</td><td>&minus;9.1</td><td>0.371</td><td>&minus;8.6</td></tr>
            <tr><td>10&deg;</td><td>0.177</td><td>&minus;15.0</td><td>0.190</td><td>&minus;14.4</td></tr>
            <tr><td>0&deg; (horizon)</td><td>0.000</td><td>null</td><td>0.000</td><td>null</td></tr>
          </tbody>
        </table>
      </div>
      <div class="explainer" style="margin-top:10px;">
        <h4>Key Result</h4>
        <p>Signal at 70&deg; is within 0.5 dB of the zenith peak. The &minus;3 dB beamwidth covers <strong>45&deg;&ndash;90&deg;</strong> &mdash; the entire NVIS cone. Low-angle radiation is suppressed by more than <strong>15 dB at 10&deg;</strong>.</p>
      </div>
    </div>

    <div class="card">
      <h2><span class="icon">&#127758;</span> NVIS Coverage vs Elevation Angle</h2>
      <div style="overflow-x:auto;">
        <table class="perf-table">
          <thead>
            <tr><th>Elevation</th><th>Ground Radius</th><th>Round-Trip</th><th>Application</th></tr>
          </thead>
          <tbody>
            <tr><td class="band-label">90&deg;</td><td>0 km</td><td>600 km</td><td style="text-align:left;">Directly overhead</td></tr>
            <tr><td>80&deg;</td><td>53 km</td><td>606 km</td><td style="text-align:left;">Local (city-wide)</td></tr>
            <tr><td>70&deg;</td><td>109 km</td><td>624 km</td><td style="text-align:left;">Regional</td></tr>
            <tr><td>60&deg;</td><td>173 km</td><td>660 km</td><td style="text-align:left;">Inter-city</td></tr>
            <tr><td>45&deg;</td><td>300 km</td><td>735 km</td><td style="text-align:left;">Extended regional</td></tr>
            <tr><td>30&deg;</td><td>520 km</td><td>866 km</td><td style="text-align:left;">Limit of NVIS zone</td></tr>
          </tbody>
        </table>
      </div>
      <div class="formula-box" style="margin-top:10px;">
        <div class="formula-title">Array Factor (Broadside, PEC Ground)</div>
        AF(&alpha;) = 2 |sin(kh &middot; sin &alpha;)|<br>
        Zenith: AF(90&deg;) = 2 |sin(kh)|<br>
        h = 5.0 m &nbsp;|&nbsp; 80 m: kh = 0.367 &nbsp;|&nbsp; 40 m: kh = 0.734
      </div>
      <div class="formula-box" style="margin-top:6px;">
        <div class="formula-title">NVIS Ground Radius (single hop)</div>
        R = H<sub>iono</sub> &times; tan(90&deg; &minus; &alpha;)<br>
        H<sub>iono</sub> &asymp; 300 km (F2-layer)
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ 2D RADIATION PATTERNS ════════════════════════════ -->
  <div class="section-label"><span>2D Radiation Pattern Cuts</span></div>
  <div class="grid triple">
    <div class="card">
      <h2><span class="icon">&#8596;</span> Azimuth (H-Plane)</h2>
      <div class="pattern-container">
        <svg id="azimuthPat" viewBox="0 0 320 320" width="100%" style="max-width:300px;"></svg>
        <div class="pattern-subtitle">Figure-8 &bull; |cos(&phi;)| &bull; Nulls along loop plane</div>
      </div>
    </div>
    <div class="card">
      <h2><span class="icon">&#8597;</span> Elevation (NVIS, Broadside)</h2>
      <div class="pattern-container">
        <svg id="elevNVIS" viewBox="0 0 320 320" width="100%" style="max-width:300px;"></svg>
        <div class="pattern-subtitle">Peak at zenith &bull; sin(kh&middot;sin&alpha;) &bull; h = 5 m</div>
      </div>
    </div>
    <div class="card">
      <h2><span class="icon">&#128065;</span> NVIS vs DX Comparison</h2>
      <div class="pattern-container">
        <svg id="nvisVsDx" viewBox="0 0 320 320" width="100%" style="max-width:300px;"></svg>
        <div class="pattern-subtitle">Orange: NVIS (5 m) &bull; Grey: Free-space (DX)</div>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ HEIGHT OPTIMIZATION + LINK BUDGET ════════════════════════════ -->
  <div class="section-label"><span>Height Optimisation &amp; NVIS Link Budget</span></div>
  <div class="grid">
    <div class="card">
      <h2><span class="icon">&#128200;</span> Zenith Signal vs Mounting Height</h2>
      <div style="overflow-x:auto;">
        <table class="perf-table">
          <thead>
            <tr><th>Height (m)</th><th>h/&lambda; (80 m)</th><th>AF (80 m)</th><th>h/&lambda; (40 m)</th><th>AF (40 m)</th></tr>
          </thead>
          <tbody>
            <tr><td>3</td><td>0.035</td><td>0.436</td><td>0.070</td><td>0.852</td></tr>
            <tr><td>4</td><td>0.047</td><td>0.578</td><td>0.093</td><td>1.105</td></tr>
            <tr style="background:rgba(255,224,178,0.25);"><td class="band-label">5 (recommended)</td><td>0.058</td><td>0.718</td><td>0.117</td><td>1.338</td></tr>
            <tr><td>8</td><td>0.093</td><td>1.110</td><td>0.187</td><td>1.814</td></tr>
            <tr><td>10</td><td>0.117</td><td>1.338</td><td>0.234</td><td>1.961</td></tr>
            <tr><td>10.7 (&lambda;/4 on 40 m)</td><td>0.125</td><td>1.414</td><td class="band-label">0.250</td><td class="band-label">2.000 (max)</td></tr>
            <tr><td>21.4 (&lambda;/4 on 80 m)</td><td class="band-label">0.250</td><td class="band-label">2.000 (max)</td><td>0.500</td><td style="color:#BF360C;font-weight:700;">0.000 (null!)</td></tr>
          </tbody>
        </table>
      </div>
      <div class="explainer" style="margin-top:10px;">
        <h4>Optimal Height Compromise</h4>
        <p><strong>5 m is recommended</strong> for dual-band NVIS. Higher mounting improves 80 m but above &lambda;/4 on 40 m (10.7 m) the 40 m zenith signal <strong>decreases</strong>. At &lambda;/4 on 80 m (21.4 m), the 40 m signal nulls completely at zenith.</p>
      </div>
    </div>

    <div class="card">
      <h2><span class="icon">&#128225;</span> NVIS Link Budget (40 m, 100 W, 300 km)</h2>
      <div style="overflow-x:auto;">
        <table class="perf-table">
          <thead>
            <tr><th style="text-align:left;">Parameter</th><th>Value</th></tr>
          </thead>
          <tbody>
            <tr><td style="text-align:left;">Transmit power</td><td>100 W (+50.0 dBm)</td></tr>
            <tr><td style="text-align:left;">Antenna efficiency</td><td>51.2% (&minus;2.9 dB)</td></tr>
            <tr><td style="text-align:left;">Antenna gain at zenith</td><td>+2.7 dBi (est., incl. ground gain)</td></tr>
            <tr><td style="text-align:left;">EIRP</td><td>+52.7 dBm</td></tr>
            <tr><td style="text-align:left;">Path loss (600 km via F2)</td><td>&minus;125 dB (typ.)</td></tr>
            <tr><td style="text-align:left;">Ionospheric absorption</td><td>&minus;10 dB (typ.)</td></tr>
            <tr><td style="text-align:left;">Receive antenna gain</td><td>+2.7 dBi</td></tr>
            <tr><td style="text-align:left;">Received signal</td><td>&minus;79.6 dBm</td></tr>
            <tr><td style="text-align:left;">Noise floor (40 m, 4 kHz)</td><td>&minus;100 dBm (typ.)</td></tr>
            <tr style="background:rgba(255,224,178,0.25);"><td style="text-align:left;" class="band-label">SNR</td><td class="band-label"><strong>+20.4 dB</strong></td></tr>
          </tbody>
        </table>
      </div>
      <div class="explainer" style="margin-top:10px;">
        <h4>Link Margin</h4>
        <p>SNR of +20 dB is comfortable for <strong>SSB voice and digital modes</strong>. Even at 25 W, the link closes with +14 dB SNR. For FT8 (requires only &minus;20 dB SNR), the system works at <strong>under 1 W</strong>.</p>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ NVIS vs DX COMPARISON TABLE ════════════════════════════ -->
  <div class="section-label"><span>NVIS vs DX Mounting Comparison</span></div>
  <div class="card full-width">
    <h2><span class="icon">&#9878;</span> What Changes for NVIS?</h2>
    <div style="overflow-x:auto;">
      <table class="comp-table">
        <thead>
          <tr><th>Parameter</th><th>Original (DX Mode)</th><th>NVIS Variant</th></tr>
        </thead>
        <tbody>
          <tr><td>Loop orientation</td><td>Vertical (standard)</td><td class="highlight-col">Vertical (same)</td></tr>
          <tr><td>Centre height</td><td>2&ndash;3 m (typical)</td><td class="highlight-col">5.0 m above ground</td></tr>
          <tr><td>Bottom clearance</td><td>~1&ndash;2 m</td><td class="highlight-col">4.0 m minimum</td></tr>
          <tr><td>Ground system</td><td>None required</td><td class="highlight-col">Ground screen recommended</td></tr>
          <tr><td>Peak radiation</td><td>Broadside (horizon)</td><td class="highlight-col">Zenith (straight up)</td></tr>
          <tr><td>Take-off angle</td><td>Low to medium (DX)</td><td class="highlight-col">70&deg;&ndash;90&deg; (NVIS)</td></tr>
          <tr><td>Primary use</td><td>DX (&gt; 500 km)</td><td class="highlight-col">Regional (0&ndash;500 km)</td></tr>
          <tr><td>Loop / cap / tube</td><td>2.0 m, vacuum, 5/8&quot; Cu</td><td class="highlight-col">Identical &mdash; no changes</td></tr>
          <tr><td>Efficiency</td><td>8.5% (80 m), 51.2% (40 m)</td><td class="highlight-col">Identical</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ════════════════════════════ SPECS + FORMULAS + MATERIALS ════════════════════════════ -->
  <div class="section-label"><span>Technical Specifications</span></div>
  <div class="grid triple">
    <div class="card">
      <h2><span class="icon">&#128295;</span> Key Specifications</h2>
      <ul class="spec-list">
        <li><span class="spec-key">Loop diameter</span><span class="spec-val">2.0 m</span></li>
        <li><span class="spec-key">Tube OD</span><span class="spec-val">15.875 mm (5/8&quot;)</span></li>
        <li><span class="spec-key">Inductance</span><span class="spec-val">6.18 &mu;H</span></li>
        <li><span class="spec-key">Tuning cap</span><span class="spec-val">84&ndash;335 pF vacuum</span></li>
        <li><span class="spec-key">Coupling loop</span><span class="spec-val">0.40 m (D/5)</span></li>
        <li><span class="spec-key">Centre height</span><span class="spec-val" style="color:#E65100;">5.0 m (NVIS)</span></li>
        <li><span class="spec-key">Bottom clearance</span><span class="spec-val" style="color:#E65100;">4.0 m</span></li>
        <li><span class="spec-key">Ground screen</span><span class="spec-val" style="color:#E65100;">4&times;4 m mesh</span></li>
        <li><span class="spec-key">Peak elevation</span><span class="spec-val" style="color:#E65100;">90&deg; (zenith)</span></li>
        <li><span class="spec-key">NVIS cone (&minus;3 dB)</span><span class="spec-val" style="color:#E65100;">45&deg;&ndash;90&deg;</span></li>
        <li><span class="spec-key">Max power</span><span class="spec-val">100 W PEP</span></li>
        <li><span class="spec-key">Coverage range</span><span class="spec-val" style="color:#E65100;">0&ndash;500 km</span></li>
      </ul>
    </div>

    <div class="card">
      <h2><span class="icon">&sum;</span> NVIS Design Formulas</h2>
      <div class="formula-box">
        <div class="formula-title">NVIS Array Factor</div>
        AF(&alpha;) = 2 |sin(kh &middot; sin &alpha;)|<br>
        k = 2&pi;/&lambda;, h = 5.0 m
      </div>
      <div class="formula-box" style="margin-top:8px;">
        <div class="formula-title">Zenith Array Factor</div>
        AF(90&deg;) = 2 |sin(kh)|<br>
        80 m: 2|sin(0.367)| = 0.718<br>
        40 m: 2|sin(0.734)| = 1.338
      </div>
      <div class="formula-box" style="margin-top:8px;">
        <div class="formula-title">Optimal Height for Max Zenith</div>
        h<sub>opt</sub> = &lambda;/4<br>
        80 m: 21.4 m | 40 m: 10.7 m<br>
        Compromise: <strong>5.0 m</strong>
      </div>
      <div class="formula-box" style="margin-top:8px;">
        <div class="formula-title">Efficiency (unchanged)</div>
        &eta; = R<sub>rad</sub> / (R<sub>rad</sub> + R<sub>loss</sub>)<br>
        80 m: 8.5% | 40 m: 51.2%
      </div>
    </div>

    <div class="card">
      <h2><span class="icon">&#128230;</span> NVIS Materials &amp; Build</h2>
      <ul class="mat-list">
        <li><strong>Main loop:</strong> 6.3 m of 5/8&quot; Cu Type M (identical to DX version)</li>
        <li><strong>Coupling loop:</strong> 0.40 m, Faraday shielded RG-213</li>
        <li><strong>Capacitor:</strong> Vacuum variable 84&ndash;335 pF, &ge; 10 kV</li>
        <li><strong>Mast:</strong> Fibreglass or wood, <strong>minimum 6 m</strong> (NVIS height)</li>
        <li><strong>Cross-arm:</strong> Non-metallic, supports loop at 10 &amp; 2 o&rsquo;clock</li>
        <li><strong>Ground screen:</strong> 4&times;4 m chicken wire (25 mm mesh) or 8 radial wires, 10 m each</li>
        <li><strong>Guy wires:</strong> Dacron or nylon (non-metallic)</li>
        <li><strong>Feed line:</strong> RG-213 / LMR-400, 50 &Omega;</li>
        <li><strong>Orientation:</strong> Loop plane N&ndash;S for E&ndash;W broadside coverage</li>
      </ul>
    </div>
  </div>

  <!-- ════════════════════════════ GROUND SCREEN ════════════════════════════ -->
  <div class="section-label"><span>Ground Screen Detail</span></div>
  <div class="card full-width">
    <h2><span class="icon">&#9783;</span> Ground Screen for NVIS Performance</h2>
    <div class="grid" style="margin-bottom:0;">
      <div>
        <div style="overflow-x:auto;">
          <table class="perf-table">
            <thead>
              <tr><th style="text-align:left;">Parameter</th><th>Specification</th></tr>
            </thead>
            <tbody>
              <tr><td style="text-align:left;">Type</td><td>Chicken wire (25 mm mesh)</td></tr>
              <tr><td style="text-align:left;">Size</td><td>4 m &times; 4 m (minimum)</td></tr>
              <tr><td style="text-align:left;">Alternative</td><td>8 radial wires, 10 m each</td></tr>
              <tr><td style="text-align:left;">Placement</td><td>On ground surface, centred below loop</td></tr>
              <tr><td style="text-align:left;">Bonding</td><td>Connect to station ground</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <div>
        <div class="explainer" style="margin-top:0;">
          <h4>Why a Ground Screen?</h4>
          <p>The ground screen improves NVIS performance by: <strong>(1)</strong> Creating a more consistent and predictable ground reflection, <strong>(2)</strong> Increasing effective ground conductivity directly under the loop, <strong>(3)</strong> Reducing ground absorption losses. For dry, sandy, or rocky soil the ground screen is <strong>strongly recommended</strong>. On moist clay soil, bare ground is often adequate.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ════════════════════════════ WARNING ════════════════════════════ -->
  <div class="warning">
    <div class="warn-icon">&#9888;</div>
    <div class="warn-text">
      <strong>HIGH VOLTAGE WARNING:</strong> At 100 W on 40 m, capacitor voltage reaches <strong>6,438 V peak</strong>; on 80 m it can exceed <strong>5,244 V peak</strong>. Lethal voltages are present during transmission. Never touch the loop or capacitor while transmitting. Use a vacuum variable capacitor rated &ge; 10 kV. The 4.0 m bottom clearance provides safe ground-level separation, but <strong>no persons should be within 1 m of the loop during TX</strong>.
    </div>
  </div>

  <!-- ════════════════════════════ FOOTER ════════════════════════════ -->
  <div class="footer">
    <strong>Dual-Band Balanced NVIS Magnetic Loop Antenna &mdash; 80 m &amp; 40 m</strong><br>
    Same antenna hardware as DX variant &bull; Optimised mounting for near-vertical radiation &bull; 0&ndash;500 km regional coverage<br>
    Theory: <em>Small Loop Antennas</em> &mdash; ARRL Antenna Book, 24th Ed. &bull;
    R. Lewallen, W7EL, &ldquo;Optimizing Small Transmitting Loops&rdquo;<br>
    Ground-reflection array theory applied to small magnetic loops &bull;
    NEC-4 modelling validation &bull; &sigma; = 5.8&times;10&sup7; S/m<br>
    <a href="https://github.com/Asteriskman2020/Magnetic-Loop-Antennas" target="_blank">github.com/Asteriskman2020/Magnetic-Loop-Antennas</a>
  </div>

</div><!-- /container -->

<script>
// ═══════════════════════════════════════════════════════════
// 3D WIREFRAME PATTERN RENDERER
// ═══════════════════════════════════════════════════════════
function render3dPattern(svgId, patternFn, opts) {
  var svg = document.getElementById(svgId);
  if (!svg) return;
  var defaults = {
    cx: 250, cy: 230, scale: 150,
    viewElev: 28, viewAzim: -35,
    nPhi: 24, nTheta: 40,
    meridianColor: '#E65100', parallelColor: '#BF360C',
    showGround: false, showZenith: true,
    groundLabel: 'GROUND PLANE', zenithLabel: 'ZENITH', title: ''
  };
  var o = {};
  var k;
  for (k in defaults) o[k] = defaults[k];
  for (k in opts) o[k] = opts[k];
  var cx = o.cx, cy = o.cy, scale = o.scale, nPhi = o.nPhi, nTheta = o.nTheta;
  var vE = o.viewElev * Math.PI / 180;
  var vA = o.viewAzim * Math.PI / 180;

  function proj(x, y, z) {
    var x1 = x * Math.cos(vA) - y * Math.sin(vA);
    var y1 = x * Math.sin(vA) + y * Math.cos(vA);
    var z2 = y1 * Math.sin(vE) + z * Math.cos(vE);
    var y2 = y1 * Math.cos(vE) - z * Math.sin(vE);
    return { px: cx + scale * x1, py: cy - scale * z2, depth: y2 };
  }
  function s2c(theta, phi, r) {
    return { x: r * Math.sin(theta) * Math.cos(phi), y: r * Math.sin(theta) * Math.sin(phi), z: r * Math.cos(theta) };
  }

  var html = '';

  // Ground plane
  if (o.showGround) {
    var gpts = [];
    for (var d = 0; d <= 360; d += 4) {
      var rad = d * Math.PI / 180;
      var p = proj(1.15 * Math.cos(rad), 1.15 * Math.sin(rad), 0);
      gpts.push(p.px.toFixed(1) + ',' + p.py.toFixed(1));
    }
    html += '<polygon points="' + gpts.join(' ') + '" fill="#795548" fill-opacity="0.06" stroke="#795548" stroke-width="1.2" stroke-opacity="0.25"/>';
    for (var i = -1; i <= 1; i += 0.5) {
      var pts1 = [], pts2 = [];
      for (var t = -1.15; t <= 1.15; t += 0.1) {
        var p1 = proj(t, i * 1.15, 0);
        pts1.push(p1.px.toFixed(1) + ',' + p1.py.toFixed(1));
        var p2 = proj(i * 1.15, t, 0);
        pts2.push(p2.px.toFixed(1) + ',' + p2.py.toFixed(1));
      }
      html += '<polyline points="' + pts1.join(' ') + '" fill="none" stroke="#795548" stroke-width="0.3" opacity="0.15"/>';
      html += '<polyline points="' + pts2.join(' ') + '" fill="none" stroke="#795548" stroke-width="0.3" opacity="0.15"/>';
    }
    var gl = proj(1.3, 1.0, 0);
    html += '<text x="' + gl.px + '" y="' + (gl.py + 4) + '" font-family="Inter,sans-serif" font-size="8" fill="#795548" font-weight="700">' + o.groundLabel + '</text>';
  }

  // Axes
  var axLen = 1.35;
  var ax1 = proj(axLen, 0, 0), ax2 = proj(-axLen, 0, 0);
  html += '<line x1="' + ax1.px + '" y1="' + ax1.py + '" x2="' + ax2.px + '" y2="' + ax2.py + '" stroke="#90A4AE" stroke-width="0.6" stroke-dasharray="5,5"/>';
  html += '<text x="' + (ax1.px + 6) + '" y="' + (ax1.py + 3) + '" font-family="Inter,sans-serif" font-size="7.5" fill="#78909C" font-weight="600">End-fire</text>';
  var ay1 = proj(0, axLen, 0), ay2 = proj(0, -axLen, 0);
  html += '<line x1="' + ay1.px + '" y1="' + ay1.py + '" x2="' + ay2.px + '" y2="' + ay2.py + '" stroke="#90A4AE" stroke-width="0.6" stroke-dasharray="5,5"/>';
  html += '<text x="' + (ay1.px + 6) + '" y="' + (ay1.py + 3) + '" font-family="Inter,sans-serif" font-size="7.5" fill="#BF360C" font-weight="700">Broadside</text>';
  if (o.showZenith) {
    var az1 = proj(0, 0, 0), az2 = proj(0, 0, axLen);
    html += '<line x1="' + az1.px + '" y1="' + az1.py + '" x2="' + az2.px + '" y2="' + az2.py + '" stroke="#607D8B" stroke-width="0.8" stroke-dasharray="4,4"/>';
    html += '<text x="' + (az2.px + 2) + '" y="' + (az2.py - 6) + '" font-family="Inter,sans-serif" font-size="9" fill="#3E2723" font-weight="800">' + o.zenithLabel + '</text>';
  }

  // Wireframe segments
  var segments = [];
  var pi, ti, phi, theta, r, c, p, pts, avgD, tMax;
  for (pi = 0; pi < nPhi; pi++) {
    phi = (pi / nPhi) * 2 * Math.PI;
    pts = []; avgD = 0;
    tMax = o.showGround ? Math.PI / 2 : Math.PI;
    for (ti = 0; ti <= nTheta; ti++) {
      theta = (ti / nTheta) * tMax;
      r = patternFn(theta, phi);
      c = s2c(theta, phi, r);
      p = proj(c.x, c.y, c.z);
      pts.push(p); avgD += p.depth;
    }
    segments.push({ pts: pts, depth: avgD / pts.length, type: 'm' });
  }
  var elevs = o.showGround ? [15, 30, 45, 60, 75, 85] : [15, 30, 45, 60, 75, 85, 105, 120, 135, 150, 165];
  elevs.forEach(function(ed) {
    var theta = (o.showGround ? (90 - ed) : ed) * Math.PI / 180;
    var pts = [], avgD = 0;
    for (var pi2 = 0; pi2 <= 360; pi2 += 3) {
      var phi2 = pi2 * Math.PI / 180;
      var r2 = patternFn(theta, phi2);
      var c2 = s2c(theta, phi2, r2);
      var p2 = proj(c2.x, c2.y, c2.z);
      pts.push(p2); avgD += p2.depth;
    }
    segments.push({ pts: pts, depth: avgD / pts.length, type: 'p', elev: ed });
  });
  segments.sort(function(a, b) { return a.depth - b.depth; });

  segments.forEach(function(seg) {
    var ptsStr = seg.pts.map(function(pp) { return pp.px.toFixed(1) + ',' + pp.py.toFixed(1); }).join(' ');
    if (seg.type === 'm') {
      html += '<polyline points="' + ptsStr + '" fill="none" stroke="' + o.meridianColor + '" stroke-width="0.8" opacity="0.45"/>';
    } else {
      var bold = seg.elev && seg.elev >= 45;
      html += '<polyline points="' + ptsStr + '" fill="none" stroke="' + o.parallelColor + '" stroke-width="' + (bold ? '1.3' : '0.7') + '" opacity="' + (bold ? '0.7' : '0.35') + '"/>';
    }
  });

  // Bold broadside & end-fire outlines
  [0, Math.PI / 2, Math.PI, 3 * Math.PI / 2].forEach(function(phi3, idx) {
    var pts3 = [];
    var tMax3 = o.showGround ? Math.PI / 2 : Math.PI;
    for (var ti3 = 0; ti3 <= 80; ti3++) {
      var theta3 = (ti3 / 80) * tMax3;
      var r3 = patternFn(theta3, phi3);
      var c3 = s2c(theta3, phi3, r3);
      var p3 = proj(c3.x, c3.y, c3.z);
      pts3.push(p3.px.toFixed(1) + ',' + p3.py.toFixed(1));
    }
    var origin = proj(0, 0, 0);
    pts3.push(origin.px.toFixed(1) + ',' + origin.py.toFixed(1));
    var isBS = (idx === 1 || idx === 3);
    html += '<polyline points="' + pts3.join(' ') + '" fill="none" stroke="' + (isBS ? o.meridianColor : '#78909C') + '" stroke-width="' + (isBS ? '2.5' : '1.5') + '" opacity="' + (isBS ? '0.85' : '0.5') + '" stroke-linejoin="round"/>';
  });

  // Loop indicator
  var loopPts = [];
  for (var ld = 0; ld <= 360; ld += 10) {
    var lrad = ld * Math.PI / 180;
    var lp = proj(0.15 * Math.cos(lrad), 0, 0.15 * Math.sin(lrad));
    loopPts.push(lp.px.toFixed(1) + ',' + lp.py.toFixed(1));
  }
  html += '<polygon points="' + loopPts.join(' ') + '" fill="rgba(191,54,12,0.15)" stroke="#BF360C" stroke-width="1.5"/>';
  var ll = proj(0.22, 0, 0);
  html += '<text x="' + (ll.px - 28) + '" y="' + (ll.py + 14) + '" font-family="Inter,sans-serif" font-size="7" fill="#BF360C" font-weight="700">LOOP</text>';

  svg.innerHTML = html;
}

// ═══════════════════════════════════════════════════════════
// 2D POLAR PATTERN RENDERER
// ═══════════════════════════════════════════════════════════
function polarPattern(svgId, patFn, opts) {
  var svg = document.getElementById(svgId);
  if (!svg) return;
  var defaults = {
    cx: 160, cy: 160, radius: 130,
    color: '#E65100', fillColor: 'rgba(230,81,0,0.12)',
    lineWidth: 2, gridColor: '#D7CCC8', steps: 360,
    isHalf: false, showCompass: true,
    compassLabels: ['0\u00B0', '90\u00B0', '180\u00B0', '270\u00B0'],
    showDbGrid: true, nullLabel: true, maxLabel: true,
    loopOrientation: false
  };
  var o = {};
  for (var kk in defaults) o[kk] = defaults[kk];
  for (var kk2 in opts) o[kk2] = opts[kk2];
  var cx = o.cx, cy = o.cy, R = o.radius;
  var html2 = '';

  // dB grid circles
  if (o.showDbGrid) {
    var dbLevels = [
      { db: 0, r: 1.0 },
      { db: -3, r: 0.708 },
      { db: -6, r: 0.501 },
      { db: -10, r: 0.316 }
    ];
    dbLevels.forEach(function(lev) {
      var cr = R * lev.r;
      if (o.isHalf) {
        html2 += '<path d="M ' + (cx - cr) + ' ' + cy + ' A ' + cr + ' ' + cr + ' 0 0 0 ' + (cx + cr) + ' ' + cy + '" fill="none" stroke="' + o.gridColor + '" stroke-width="0.6" stroke-dasharray="3,3"/>';
      } else {
        html2 += '<circle cx="' + cx + '" cy="' + cy + '" r="' + cr + '" fill="none" stroke="' + o.gridColor + '" stroke-width="0.6" stroke-dasharray="3,3"/>';
      }
      html2 += '<text x="' + (cx + 3) + '" y="' + (cy - cr - 2) + '" font-family="JetBrains Mono,monospace" font-size="6.5" fill="#8D6E63" font-weight="500">' + lev.db + ' dB</text>';
    });
  }

  // Cross-hairs
  if (o.isHalf) {
    html2 += '<line x1="' + (cx - R - 10) + '" y1="' + cy + '" x2="' + (cx + R + 10) + '" y2="' + cy + '" stroke="' + o.gridColor + '" stroke-width="0.8"/>';
    html2 += '<line x1="' + cx + '" y1="' + cy + '" x2="' + cx + '" y2="' + (cy - R - 10) + '" stroke="' + o.gridColor + '" stroke-width="0.8"/>';
    html2 += '<line x1="' + cx + '" y1="' + cy + '" x2="' + (cx - R * 0.707) + '" y2="' + (cy - R * 0.707) + '" stroke="' + o.gridColor + '" stroke-width="0.4" stroke-dasharray="2,3"/>';
    html2 += '<line x1="' + cx + '" y1="' + cy + '" x2="' + (cx + R * 0.707) + '" y2="' + (cy - R * 0.707) + '" stroke="' + o.gridColor + '" stroke-width="0.4" stroke-dasharray="2,3"/>';
  } else {
    html2 += '<line x1="' + (cx - R - 10) + '" y1="' + cy + '" x2="' + (cx + R + 10) + '" y2="' + cy + '" stroke="' + o.gridColor + '" stroke-width="0.8"/>';
    html2 += '<line x1="' + cx + '" y1="' + (cy - R - 10) + '" x2="' + cx + '" y2="' + (cy + R + 10) + '" stroke="' + o.gridColor + '" stroke-width="0.8"/>';
    html2 += '<line x1="' + (cx - R * 0.707) + '" y1="' + (cy - R * 0.707) + '" x2="' + (cx + R * 0.707) + '" y2="' + (cy + R * 0.707) + '" stroke="' + o.gridColor + '" stroke-width="0.4" stroke-dasharray="2,3"/>';
    html2 += '<line x1="' + (cx + R * 0.707) + '" y1="' + (cy - R * 0.707) + '" x2="' + (cx - R * 0.707) + '" y2="' + (cy + R * 0.707) + '" stroke="' + o.gridColor + '" stroke-width="0.4" stroke-dasharray="2,3"/>';
  }

  // Compass labels
  if (o.showCompass) {
    var labels = o.compassLabels;
    if (o.isHalf) {
      html2 += '<text x="' + (cx + R + 8) + '" y="' + (cy + 4) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700">' + labels[0] + '</text>';
      html2 += '<text x="' + cx + '" y="' + (cy - R - 6) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700" text-anchor="middle">' + labels[1] + '</text>';
      html2 += '<text x="' + (cx - R - 18) + '" y="' + (cy + 4) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700">' + labels[2] + '</text>';
    } else {
      html2 += '<text x="' + (cx + R + 6) + '" y="' + (cy + 4) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700">' + labels[0] + '</text>';
      html2 += '<text x="' + cx + '" y="' + (cy - R - 6) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700" text-anchor="middle">' + labels[1] + '</text>';
      html2 += '<text x="' + (cx - R - 20) + '" y="' + (cy + 4) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700">' + labels[2] + '</text>';
      html2 += '<text x="' + cx + '" y="' + (cy + R + 14) + '" font-family="Inter,sans-serif" font-size="8" fill="#5D4037" font-weight="700" text-anchor="middle">' + labels[3] + '</text>';
    }
  }

  // Pattern curve
  var points = [];
  var startAngle = o.isHalf ? -Math.PI / 2 : 0;
  var endAngle = o.isHalf ? Math.PI / 2 : 2 * Math.PI;
  var numSteps = o.steps;
  for (var si = 0; si <= numSteps; si++) {
    var angle = startAngle + (si / numSteps) * (endAngle - startAngle);
    var rr = patFn(angle);
    if (rr < 0) rr = 0;
    var px = cx + R * rr * Math.cos(angle);
    var py = cy - R * rr * Math.sin(angle);
    points.push(px.toFixed(1) + ',' + py.toFixed(1));
  }

  // Fill
  if (o.isHalf) {
    html2 += '<polygon points="' + cx + ',' + cy + ' ' + points.join(' ') + ' ' + cx + ',' + cy + '" fill="' + o.fillColor + '" stroke="none"/>';
  } else {
    html2 += '<polygon points="' + points.join(' ') + '" fill="' + o.fillColor + '" stroke="none"/>';
  }
  html2 += '<polyline points="' + points.join(' ') + '" fill="none" stroke="' + o.color + '" stroke-width="' + o.lineWidth + '" stroke-linejoin="round"/>';

  // Null and max markers
  if (o.nullLabel && !o.isHalf) {
    var minVal = 1, minAngle = 0;
    for (var mi = 0; mi < 360; mi++) {
      var ma = mi * Math.PI / 180;
      var mv = patFn(ma);
      if (mv < minVal) { minVal = mv; minAngle = ma; }
    }
    if (minVal < 0.1) {
      var nx = cx + (R + 16) * Math.cos(minAngle);
      var ny = cy - (R + 16) * Math.sin(minAngle);
      html2 += '<text x="' + nx + '" y="' + ny + '" font-family="Inter,sans-serif" font-size="7" fill="#BF360C" font-weight="700" text-anchor="middle">NULL</text>';
      var nx2 = cx + (R + 16) * Math.cos(minAngle + Math.PI);
      var ny2 = cy - (R + 16) * Math.sin(minAngle + Math.PI);
      html2 += '<text x="' + nx2 + '" y="' + ny2 + '" font-family="Inter,sans-serif" font-size="7" fill="#BF360C" font-weight="700" text-anchor="middle">NULL</text>';
    }
  }

  if (o.maxLabel && !o.isHalf) {
    var maxVal2 = 0, maxAngle2 = 0;
    for (var mi2 = 0; mi2 < 360; mi2++) {
      var ma2 = mi2 * Math.PI / 180;
      var mv2 = patFn(ma2);
      if (mv2 > maxVal2) { maxVal2 = mv2; maxAngle2 = ma2; }
    }
    if (maxVal2 > 0.5) {
      var mx = cx + (R * maxVal2 + 14) * Math.cos(maxAngle2);
      var my = cy - (R * maxVal2 + 14) * Math.sin(maxAngle2);
      html2 += '<text x="' + mx + '" y="' + my + '" font-family="Inter,sans-serif" font-size="7" fill="#E65100" font-weight="700" text-anchor="middle">MAX</text>';
    }
  }

  // Loop orientation indicator
  if (o.loopOrientation) {
    html2 += '<line x1="' + (cx - 12) + '" y1="' + cy + '" x2="' + (cx + 12) + '" y2="' + cy + '" stroke="#BF360C" stroke-width="2.5" stroke-linecap="round"/>';
    html2 += '<text x="' + cx + '" y="' + (cy + 16) + '" font-family="Inter,sans-serif" font-size="6" fill="#BF360C" font-weight="700" text-anchor="middle">LOOP</text>';
  }

  // Extra overlay pattern
  if (o.overlayFn) {
    var pts2 = [];
    for (var si2 = 0; si2 <= numSteps; si2++) {
      var angle2 = startAngle + (si2 / numSteps) * (endAngle - startAngle);
      var rr2 = o.overlayFn(angle2);
      if (rr2 < 0) rr2 = 0;
      var px2 = cx + R * rr2 * Math.cos(angle2);
      var py2 = cy - R * rr2 * Math.sin(angle2);
      pts2.push(px2.toFixed(1) + ',' + py2.toFixed(1));
    }
    if (o.isHalf) {
      html2 += '<polygon points="' + cx + ',' + cy + ' ' + pts2.join(' ') + ' ' + cx + ',' + cy + '" fill="' + (o.overlayFill || 'rgba(120,144,156,0.08)') + '" stroke="none"/>';
    } else {
      html2 += '<polygon points="' + pts2.join(' ') + '" fill="' + (o.overlayFill || 'rgba(120,144,156,0.08)') + '" stroke="none"/>';
    }
    html2 += '<polyline points="' + pts2.join(' ') + '" fill="none" stroke="' + (o.overlayColor || '#90A4AE') + '" stroke-width="1.5" stroke-dasharray="4,3" stroke-linejoin="round"/>';
  }

  svg.innerHTML = html2;
}

// ═══════════════════════════════════════════════════════════
// RENDER ALL PATTERNS ON LOAD
// ═══════════════════════════════════════════════════════════
window.addEventListener('DOMContentLoaded', function() {

  // 3D NVIS Over-Ground (40m, kh=0.734 at 5m height)
  render3dPattern('nvis3d', function(theta, phi) {
    var sinPsi2 = 1 - Math.pow(Math.sin(theta) * Math.sin(phi), 2);
    var sinPsi = Math.sqrt(Math.max(0, sinPsi2));
    var kh = 0.734; // 40m band, h=5m
    var af = Math.abs(Math.sin(kh * Math.cos(theta)));
    var normFactor = Math.sin(kh);
    if (normFactor < 0.001) normFactor = 0.001;
    return sinPsi * af / normFactor;
  }, {
    meridianColor: '#BF360C',
    parallelColor: '#8B1A00',
    showGround: true,
    showZenith: true,
    zenithLabel: 'ZENITH (PEAK)',
    groundLabel: 'GROUND PLANE'
  });

  // 3D Free-Space Toroidal (reference)
  render3dPattern('toroid3d', function(theta, phi) {
    var sinTsinP = Math.sin(theta) * Math.sin(phi);
    return Math.sqrt(Math.max(0, 1 - sinTsinP * sinTsinP));
  }, {
    meridianColor: '#E65100',
    parallelColor: '#BF360C',
    showGround: false,
    showZenith: true,
    zenithLabel: 'ZENITH'
  });

  // 2D Azimuth figure-8
  polarPattern('azimuthPat', function(rad) {
    return Math.abs(Math.cos(rad));
  }, {
    color: '#E65100',
    fillColor: 'rgba(230,81,0,0.1)',
    compassLabels: ['Broadside', 'N', 'Broadside', 'S'],
    loopOrientation: true,
    nullLabel: true,
    maxLabel: true
  });

  // 2D Elevation: NVIS pattern (peak at zenith)
  polarPattern('elevNVIS', function(rad) {
    // rad: 0=right(horizon), PI/2=up(zenith), PI=left(horizon), 3PI/2=down
    // Elevation angle from horizon
    var kh = 0.734;
    var elev = rad; // angle measured from horizon going up
    var af = Math.abs(Math.sin(kh * Math.sin(elev)));
    var normFactor = Math.sin(kh);
    if (normFactor < 0.001) normFactor = 0.001;
    return af / normFactor;
  }, {
    isHalf: true,
    color: '#E65100',
    fillColor: 'rgba(230,81,0,0.12)',
    compassLabels: ['Horizon', 'Zenith', 'Horizon'],
    nullLabel: false,
    maxLabel: false
  });

  // 2D NVIS vs DX comparison (half-plane)
  polarPattern('nvisVsDx', function(rad) {
    var kh = 0.734;
    var af = Math.abs(Math.sin(kh * Math.sin(rad)));
    var normFactor = Math.sin(kh);
    if (normFactor < 0.001) normFactor = 0.001;
    return af / normFactor;
  }, {
    isHalf: true,
    color: '#E65100',
    fillColor: 'rgba(230,81,0,0.1)',
    compassLabels: ['Horizon', 'Zenith', 'Horizon'],
    nullLabel: false,
    maxLabel: false,
    overlayFn: function(rad) {
      return Math.abs(Math.sin(rad));
    },
    overlayColor: '#90A4AE',
    overlayFill: 'rgba(120,144,156,0.06)'
  });

});
</script>
</body>
</html>
